"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth/[...nextauth]";
exports.ids = ["pages/api/auth/[...nextauth]"];
exports.modules = {

/***/ "(api-node)/./lib/auth.js":
/*!*********************!*\
  !*** ./lib/auth.js ***!
  \*********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createUser: () => (/* binding */ createUser),\n/* harmony export */   getTrialStatus: () => (/* binding */ getTrialStatus),\n/* harmony export */   getUserByEmail: () => (/* binding */ getUserByEmail),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   isAuthenticated: () => (/* binding */ isAuthenticated),\n/* harmony export */   isTrialActive: () => (/* binding */ isTrialActive),\n/* harmony export */   requireAuthentication: () => (/* binding */ requireAuthentication),\n/* harmony export */   updateSubscriptionStatus: () => (/* binding */ updateSubscriptionStatus),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/react */ \"next-auth/react\");\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./mongodb */ \"(api-node)/./lib/mongodb.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bcryptjs__WEBPACK_IMPORTED_MODULE_1__]);\nbcryptjs__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nasync function hashPassword(password) {\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].hash(password, 12);\n}\nasync function verifyPassword(password, hashedPassword) {\n    try {\n        // Special case for test user (makes debugging easier)\n        if (password === 'password123' && hashedPassword === 'password123') {\n            console.log('Special case: Test user with unhashed password');\n            return true;\n        }\n        // For debugging\n        console.log(`Verifying password - Hash starts with: ${hashedPassword.substring(0, 10)}...`);\n        return await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compare(password, hashedPassword);\n    } catch (error) {\n        console.error('Error comparing passwords:', error);\n        console.error('Password hash:', hashedPassword ? hashedPassword.substring(0, 10) + '...' : 'NULL');\n        return false;\n    }\n}\n// Get user from MongoDB using their email\nasync function getUserByEmail(email) {\n    try {\n        if (!email) {\n            console.error('getUserByEmail called with empty email');\n            return null;\n        }\n        console.log(`Looking up user with email: ${email}`);\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        const user = await db.collection('users').findOne({\n            email\n        });\n        if (user) {\n            console.log(`Found user with email ${email}, ID: ${user._id}`);\n        } else {\n            console.log(`No user found with email: ${email}`);\n        }\n        return user;\n    } catch (error) {\n        console.error('Error in getUserByEmail:', error);\n        throw new Error(`Database error when fetching user: ${error.message}`);\n    }\n}\n// Create a new user in MongoDB\nasync function createUser(userData) {\n    try {\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        const { email, password, name, trial_start_date, is_subscribed } = userData;\n        console.log(`Hashing password for new user: ${email}`);\n        const hashedPassword = await hashPassword(password);\n        // Format trial start date properly\n        const trialStartDate = trial_start_date ? new Date(trial_start_date) : new Date();\n        // Create a full user record\n        const userDoc = {\n            email,\n            password: hashedPassword,\n            name: name || email.split('@')[0],\n            trial_start_date: trialStartDate,\n            is_subscribed: is_subscribed || false,\n            createdAt: new Date(),\n            lastLogin: new Date()\n        };\n        console.log(`Inserting new user into database: ${email}`);\n        const result = await db.collection('users').insertOne(userDoc);\n        console.log(`User inserted successfully, ID: ${result.insertedId}`);\n        // Return user object with ID for session creation\n        return {\n            id: result.insertedId.toString(),\n            _id: result.insertedId,\n            email,\n            name: userDoc.name,\n            trial_start_date: trialStartDate,\n            is_subscribed: userDoc.is_subscribed\n        };\n    } catch (error) {\n        console.error('Error in createUser:', error);\n        throw new Error(`Database error when creating user: ${error.message}`);\n    }\n}\n// Check if a user is authenticated for API routes\nasync function isAuthenticated(req, res) {\n    const session = await (0,next_auth_react__WEBPACK_IMPORTED_MODULE_0__.getSession)({\n        req\n    });\n    if (!session) {\n        res.status(401).json({\n            error: 'Not authenticated'\n        });\n        return false;\n    }\n    return session;\n}\n// Check if trial is active for a user\nasync function isTrialActive(userId) {\n    try {\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        // Get the user with the given id\n        const user = await db.collection('users').findOne({\n            _id: userId\n        });\n        if (!user) {\n            return false;\n        }\n        // If user is subscribed, trial status doesn't matter\n        if (user.is_subscribed) {\n            return true;\n        }\n        // Check if the trial has expired (7 days from start)\n        const trialStartDate = user.trial_start_date ? new Date(user.trial_start_date) : null;\n        if (!trialStartDate) {\n            return false; // No trial start date found\n        }\n        // Calculate trial end date (7 days after start)\n        const trialEndDate = new Date(trialStartDate);\n        trialEndDate.setDate(trialEndDate.getDate() + 7);\n        // Check if current date is before trial end date\n        const currentDate = new Date();\n        return currentDate < trialEndDate;\n    } catch (error) {\n        console.error('Error checking trial status:', error);\n        return false; // Default to trial expired on error\n    }\n}\n// Get trial status information for a user\nasync function getTrialStatus(userId) {\n    try {\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        // Get the user with the given id\n        const user = await db.collection('users').findOne({\n            _id: userId\n        });\n        if (!user) {\n            throw new Error('User not found');\n        }\n        // If user is already subscribed\n        if (user.is_subscribed) {\n            return {\n                isActive: true,\n                isSubscribed: true,\n                trialStartDate: user.trial_start_date,\n                trialEndDate: null,\n                daysRemaining: 0,\n                message: 'Subscribed account'\n            };\n        }\n        // Calculate trial information\n        const trialStartDate = user.trial_start_date ? new Date(user.trial_start_date) : new Date();\n        const trialEndDate = new Date(trialStartDate);\n        trialEndDate.setDate(trialEndDate.getDate() + 7);\n        const currentDate = new Date();\n        const isActive = currentDate < trialEndDate;\n        // Calculate days remaining\n        const diffTime = trialEndDate.getTime() - currentDate.getTime();\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n        const daysRemaining = Math.max(0, diffDays);\n        // Return trial status\n        return {\n            isActive,\n            isSubscribed: false,\n            trialStartDate,\n            trialEndDate,\n            daysRemaining,\n            message: isActive ? `Trial active - ${daysRemaining} days remaining` : 'Trial has expired'\n        };\n    } catch (error) {\n        console.error('Error getting trial status:', error);\n        throw error;\n    }\n}\n// Update subscription status\nasync function updateSubscriptionStatus(userId, isSubscribed) {\n    try {\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        // Update the user with subscription status\n        const result = await db.collection('users').updateOne({\n            _id: userId\n        }, {\n            $set: {\n                is_subscribed: isSubscribed\n            }\n        });\n        return result.modifiedCount > 0;\n    } catch (error) {\n        console.error('Error updating subscription status:', error);\n        throw error;\n    }\n}\n// Check if a user is authenticated, has active trial/subscription and redirect if needed\nasync function requireAuthentication(context) {\n    const session = await (0,next_auth_react__WEBPACK_IMPORTED_MODULE_0__.getSession)(context);\n    // If no user is logged in, redirect to login\n    if (!session) {\n        return {\n            redirect: {\n                destination: '/login',\n                permanent: false\n            }\n        };\n    }\n    try {\n        // Get full user data including trial/subscription info\n        const db = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_2__.getDatabase)();\n        const user = await db.collection('users').findOne({\n            email: session.user.email\n        });\n        // If user not found in database but has session\n        if (!user) {\n            // Clear session and redirect to login\n            return {\n                redirect: {\n                    destination: '/login',\n                    permanent: false\n                }\n            };\n        }\n        // Check if subscribed or trial is active\n        const isSubscribed = user.is_subscribed;\n        if (isSubscribed) {\n            // User is subscribed, allow access\n            return {\n                props: {\n                    user: {\n                        ...session.user,\n                        isSubscribed: true,\n                        trialActive: true\n                    }\n                }\n            };\n        }\n        // Check trial status\n        const trialStartDate = user.trial_start_date ? new Date(user.trial_start_date) : null;\n        if (!trialStartDate) {\n            // No trial start date, redirect to upgrade\n            return {\n                redirect: {\n                    destination: '/upgrade',\n                    permanent: false\n                }\n            };\n        }\n        // Calculate trial end date and compare with current date\n        const trialEndDate = new Date(trialStartDate);\n        trialEndDate.setDate(trialEndDate.getDate() + 7);\n        const currentDate = new Date();\n        const trialActive = currentDate < trialEndDate;\n        if (!trialActive) {\n            // Trial has expired, redirect to upgrade page\n            return {\n                redirect: {\n                    destination: '/upgrade',\n                    permanent: false\n                }\n            };\n        }\n        // Calculate days remaining in trial\n        const diffTime = trialEndDate.getTime() - currentDate.getTime();\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n        const daysRemaining = Math.max(0, diffDays);\n        // Trial is active, allow access with trial info\n        return {\n            props: {\n                user: {\n                    ...session.user,\n                    isSubscribed: false,\n                    trialActive: true,\n                    trialEndDate: trialEndDate.toISOString(),\n                    daysRemaining\n                }\n            }\n        };\n    } catch (error) {\n        console.error('Error in requireAuthentication:', error);\n        // On error, default to allowing access with warning\n        // This prevents locked-out users in case of database errors\n        return {\n            props: {\n                user: {\n                    ...session.user,\n                    isSubscribed: false,\n                    trialActive: true,\n                    trialStatus: 'unknown',\n                    error: 'Could not verify subscription status'\n                }\n            }\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2xCO2dCQUNGO1lBQ0Y7UUFDRjtJQUNGLEVBQUUsT0FBT3pDLE9BQU87UUFDZEosUUFBUUksS0FBSyxDQUFDLG1DQUFtQ0E7UUFFakQsb0RBQW9EO1FBQ3BELDREQUE0RDtRQUM1RCxPQUFPO1lBQ0x5RCxPQUFPO2dCQUNMckQsTUFBTTtvQkFDSixHQUFHeUIsUUFBUXpCLElBQUk7b0JBQ2ZvQyxjQUFjO29CQUNka0IsYUFBYTtvQkFDYkUsYUFBYTtvQkFDYjVELE9BQU87Z0JBQ1Q7WUFDRjtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9saWIvYXV0aC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL3JlYWN0JztcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xuaW1wb3J0IHsgZ2V0RGF0YWJhc2UgfSBmcm9tICcuL21vbmdvZGInO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkKSB7XG4gIHJldHVybiBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTIpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UGFzc3dvcmQocGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKSB7XG4gIHRyeSB7XG4gICAgLy8gU3BlY2lhbCBjYXNlIGZvciB0ZXN0IHVzZXIgKG1ha2VzIGRlYnVnZ2luZyBlYXNpZXIpXG4gICAgaWYgKHBhc3N3b3JkID09PSAncGFzc3dvcmQxMjMnICYmIGhhc2hlZFBhc3N3b3JkID09PSAncGFzc3dvcmQxMjMnKSB7XG4gICAgICBjb25zb2xlLmxvZygnU3BlY2lhbCBjYXNlOiBUZXN0IHVzZXIgd2l0aCB1bmhhc2hlZCBwYXNzd29yZCcpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIEZvciBkZWJ1Z2dpbmdcbiAgICBjb25zb2xlLmxvZyhgVmVyaWZ5aW5nIHBhc3N3b3JkIC0gSGFzaCBzdGFydHMgd2l0aDogJHtoYXNoZWRQYXNzd29yZC5zdWJzdHJpbmcoMCwgMTApfS4uLmApO1xuICAgIFxuICAgIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaGVkUGFzc3dvcmQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbXBhcmluZyBwYXNzd29yZHM6JywgZXJyb3IpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ1Bhc3N3b3JkIGhhc2g6JywgaGFzaGVkUGFzc3dvcmQgPyBoYXNoZWRQYXNzd29yZC5zdWJzdHJpbmcoMCwgMTApICsgJy4uLicgOiAnTlVMTCcpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vLyBHZXQgdXNlciBmcm9tIE1vbmdvREIgdXNpbmcgdGhlaXIgZW1haWxcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRVc2VyQnlFbWFpbChlbWFpbCkge1xuICB0cnkge1xuICAgIGlmICghZW1haWwpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ2dldFVzZXJCeUVtYWlsIGNhbGxlZCB3aXRoIGVtcHR5IGVtYWlsJyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYExvb2tpbmcgdXAgdXNlciB3aXRoIGVtYWlsOiAke2VtYWlsfWApO1xuICAgIFxuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgZW1haWwgfSk7XG4gICAgXG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCB1c2VyIHdpdGggZW1haWwgJHtlbWFpbH0sIElEOiAke3VzZXIuX2lkfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgTm8gdXNlciBmb3VuZCB3aXRoIGVtYWlsOiAke2VtYWlsfWApO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdXNlcjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRVc2VyQnlFbWFpbDonLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEYXRhYmFzZSBlcnJvciB3aGVuIGZldGNoaW5nIHVzZXI6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vLyBDcmVhdGUgYSBuZXcgdXNlciBpbiBNb25nb0RCXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVXNlcih1c2VyRGF0YSkge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKTtcbiAgICBcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCwgbmFtZSwgdHJpYWxfc3RhcnRfZGF0ZSwgaXNfc3Vic2NyaWJlZCB9ID0gdXNlckRhdGE7XG4gICAgXG4gICAgY29uc29sZS5sb2coYEhhc2hpbmcgcGFzc3dvcmQgZm9yIG5ldyB1c2VyOiAke2VtYWlsfWApO1xuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcbiAgICBcbiAgICAvLyBGb3JtYXQgdHJpYWwgc3RhcnQgZGF0ZSBwcm9wZXJseVxuICAgIGNvbnN0IHRyaWFsU3RhcnREYXRlID0gdHJpYWxfc3RhcnRfZGF0ZSA/IG5ldyBEYXRlKHRyaWFsX3N0YXJ0X2RhdGUpIDogbmV3IERhdGUoKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYSBmdWxsIHVzZXIgcmVjb3JkXG4gICAgY29uc3QgdXNlckRvYyA9IHtcbiAgICAgIGVtYWlsLFxuICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgbmFtZTogbmFtZSB8fCBlbWFpbC5zcGxpdCgnQCcpWzBdLCAvLyBVc2UgZW1haWwgcHJlZml4IGFzIG5hbWUgaWYgbm90IHByb3ZpZGVkXG4gICAgICB0cmlhbF9zdGFydF9kYXRlOiB0cmlhbFN0YXJ0RGF0ZSxcbiAgICAgIGlzX3N1YnNjcmliZWQ6IGlzX3N1YnNjcmliZWQgfHwgZmFsc2UsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICBsYXN0TG9naW46IG5ldyBEYXRlKCksXG4gICAgfTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgSW5zZXJ0aW5nIG5ldyB1c2VyIGludG8gZGF0YWJhc2U6ICR7ZW1haWx9YCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5pbnNlcnRPbmUodXNlckRvYyk7XG4gICAgXG4gICAgY29uc29sZS5sb2coYFVzZXIgaW5zZXJ0ZWQgc3VjY2Vzc2Z1bGx5LCBJRDogJHtyZXN1bHQuaW5zZXJ0ZWRJZH1gKTtcbiAgICBcbiAgICAvLyBSZXR1cm4gdXNlciBvYmplY3Qgd2l0aCBJRCBmb3Igc2Vzc2lvbiBjcmVhdGlvblxuICAgIHJldHVybiB7IFxuICAgICAgaWQ6IHJlc3VsdC5pbnNlcnRlZElkLnRvU3RyaW5nKCksIC8vIENvbnZlcnQgT2JqZWN0SWQgdG8gc3RyaW5nXG4gICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLCAvLyBJbmNsdWRlIHJhdyBfaWQgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgIGVtYWlsLCBcbiAgICAgIG5hbWU6IHVzZXJEb2MubmFtZSwgXG4gICAgICB0cmlhbF9zdGFydF9kYXRlOiB0cmlhbFN0YXJ0RGF0ZSxcbiAgICAgIGlzX3N1YnNjcmliZWQ6IHVzZXJEb2MuaXNfc3Vic2NyaWJlZFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlVXNlcjonLCBlcnJvcik7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEYXRhYmFzZSBlcnJvciB3aGVuIGNyZWF0aW5nIHVzZXI6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vLyBDaGVjayBpZiBhIHVzZXIgaXMgYXV0aGVudGljYXRlZCBmb3IgQVBJIHJvdXRlc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZChyZXEsIHJlcykge1xuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2Vzc2lvbih7IHJlcSB9KTtcbiAgXG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdOb3QgYXV0aGVudGljYXRlZCcgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICByZXR1cm4gc2Vzc2lvbjtcbn1cblxuLy8gQ2hlY2sgaWYgdHJpYWwgaXMgYWN0aXZlIGZvciBhIHVzZXJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc1RyaWFsQWN0aXZlKHVzZXJJZCkge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKTtcbiAgICBcbiAgICAvLyBHZXQgdGhlIHVzZXIgd2l0aCB0aGUgZ2l2ZW4gaWRcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgX2lkOiB1c2VySWQgfSk7XG4gICAgXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIElmIHVzZXIgaXMgc3Vic2NyaWJlZCwgdHJpYWwgc3RhdHVzIGRvZXNuJ3QgbWF0dGVyXG4gICAgaWYgKHVzZXIuaXNfc3Vic2NyaWJlZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGlmIHRoZSB0cmlhbCBoYXMgZXhwaXJlZCAoNyBkYXlzIGZyb20gc3RhcnQpXG4gICAgY29uc3QgdHJpYWxTdGFydERhdGUgPSB1c2VyLnRyaWFsX3N0YXJ0X2RhdGUgPyBuZXcgRGF0ZSh1c2VyLnRyaWFsX3N0YXJ0X2RhdGUpIDogbnVsbDtcbiAgICBcbiAgICBpZiAoIXRyaWFsU3RhcnREYXRlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7IC8vIE5vIHRyaWFsIHN0YXJ0IGRhdGUgZm91bmRcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHRyaWFsIGVuZCBkYXRlICg3IGRheXMgYWZ0ZXIgc3RhcnQpXG4gICAgY29uc3QgdHJpYWxFbmREYXRlID0gbmV3IERhdGUodHJpYWxTdGFydERhdGUpO1xuICAgIHRyaWFsRW5kRGF0ZS5zZXREYXRlKHRyaWFsRW5kRGF0ZS5nZXREYXRlKCkgKyA3KTtcbiAgICBcbiAgICAvLyBDaGVjayBpZiBjdXJyZW50IGRhdGUgaXMgYmVmb3JlIHRyaWFsIGVuZCBkYXRlXG4gICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBjdXJyZW50RGF0ZSA8IHRyaWFsRW5kRGF0ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyB0cmlhbCBzdGF0dXM6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTsgLy8gRGVmYXVsdCB0byB0cmlhbCBleHBpcmVkIG9uIGVycm9yXG4gIH1cbn1cblxuLy8gR2V0IHRyaWFsIHN0YXR1cyBpbmZvcm1hdGlvbiBmb3IgYSB1c2VyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHJpYWxTdGF0dXModXNlcklkKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYXRhYmFzZSgpO1xuICAgIFxuICAgIC8vIEdldCB0aGUgdXNlciB3aXRoIHRoZSBnaXZlbiBpZFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmZpbmRPbmUoeyBfaWQ6IHVzZXJJZCB9KTtcbiAgICBcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgdXNlciBpcyBhbHJlYWR5IHN1YnNjcmliZWRcbiAgICBpZiAodXNlci5pc19zdWJzY3JpYmVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgaXNTdWJzY3JpYmVkOiB0cnVlLFxuICAgICAgICB0cmlhbFN0YXJ0RGF0ZTogdXNlci50cmlhbF9zdGFydF9kYXRlLFxuICAgICAgICB0cmlhbEVuZERhdGU6IG51bGwsXG4gICAgICAgIGRheXNSZW1haW5pbmc6IDAsXG4gICAgICAgIG1lc3NhZ2U6ICdTdWJzY3JpYmVkIGFjY291bnQnXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgdHJpYWwgaW5mb3JtYXRpb25cbiAgICBjb25zdCB0cmlhbFN0YXJ0RGF0ZSA9IHVzZXIudHJpYWxfc3RhcnRfZGF0ZSA/IG5ldyBEYXRlKHVzZXIudHJpYWxfc3RhcnRfZGF0ZSkgOiBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHRyaWFsRW5kRGF0ZSA9IG5ldyBEYXRlKHRyaWFsU3RhcnREYXRlKTtcbiAgICB0cmlhbEVuZERhdGUuc2V0RGF0ZSh0cmlhbEVuZERhdGUuZ2V0RGF0ZSgpICsgNyk7XG4gICAgXG4gICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGlzQWN0aXZlID0gY3VycmVudERhdGUgPCB0cmlhbEVuZERhdGU7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGRheXMgcmVtYWluaW5nXG4gICAgY29uc3QgZGlmZlRpbWUgPSB0cmlhbEVuZERhdGUuZ2V0VGltZSgpIC0gY3VycmVudERhdGUuZ2V0VGltZSgpO1xuICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgICBjb25zdCBkYXlzUmVtYWluaW5nID0gTWF0aC5tYXgoMCwgZGlmZkRheXMpO1xuICAgIFxuICAgIC8vIFJldHVybiB0cmlhbCBzdGF0dXNcbiAgICByZXR1cm4ge1xuICAgICAgaXNBY3RpdmUsXG4gICAgICBpc1N1YnNjcmliZWQ6IGZhbHNlLFxuICAgICAgdHJpYWxTdGFydERhdGUsXG4gICAgICB0cmlhbEVuZERhdGUsXG4gICAgICBkYXlzUmVtYWluaW5nLFxuICAgICAgbWVzc2FnZTogaXNBY3RpdmUgXG4gICAgICAgID8gYFRyaWFsIGFjdGl2ZSAtICR7ZGF5c1JlbWFpbmluZ30gZGF5cyByZW1haW5pbmdgIFxuICAgICAgICA6ICdUcmlhbCBoYXMgZXhwaXJlZCdcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdHJpYWwgc3RhdHVzOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBVcGRhdGUgc3Vic2NyaXB0aW9uIHN0YXR1c1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvblN0YXR1cyh1c2VySWQsIGlzU3Vic2NyaWJlZCkge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgd2l0aCBzdWJzY3JpcHRpb24gc3RhdHVzXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS51cGRhdGVPbmUoXG4gICAgICB7IF9pZDogdXNlcklkIH0sXG4gICAgICB7ICRzZXQ6IHsgaXNfc3Vic2NyaWJlZDogaXNTdWJzY3JpYmVkIH0gfVxuICAgICk7XG4gICAgXG4gICAgcmV0dXJuIHJlc3VsdC5tb2RpZmllZENvdW50ID4gMDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBzdWJzY3JpcHRpb24gc3RhdHVzOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBDaGVjayBpZiBhIHVzZXIgaXMgYXV0aGVudGljYXRlZCwgaGFzIGFjdGl2ZSB0cmlhbC9zdWJzY3JpcHRpb24gYW5kIHJlZGlyZWN0IGlmIG5lZWRlZFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVBdXRoZW50aWNhdGlvbihjb250ZXh0KSB7XG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXNzaW9uKGNvbnRleHQpO1xuICBcbiAgLy8gSWYgbm8gdXNlciBpcyBsb2dnZWQgaW4sIHJlZGlyZWN0IHRvIGxvZ2luXG4gIGlmICghc2Vzc2lvbikge1xuICAgIHJldHVybiB7XG4gICAgICByZWRpcmVjdDoge1xuICAgICAgICBkZXN0aW5hdGlvbjogJy9sb2dpbicsXG4gICAgICAgIHBlcm1hbmVudDogZmFsc2UsXG4gICAgICB9LFxuICAgIH07XG4gIH1cbiAgXG4gIHRyeSB7XG4gICAgLy8gR2V0IGZ1bGwgdXNlciBkYXRhIGluY2x1ZGluZyB0cmlhbC9zdWJzY3JpcHRpb24gaW5mb1xuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgZW1haWw6IHNlc3Npb24udXNlci5lbWFpbCB9KTtcbiAgICBcbiAgICAvLyBJZiB1c2VyIG5vdCBmb3VuZCBpbiBkYXRhYmFzZSBidXQgaGFzIHNlc3Npb25cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIC8vIENsZWFyIHNlc3Npb24gYW5kIHJlZGlyZWN0IHRvIGxvZ2luXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgIGRlc3RpbmF0aW9uOiAnL2xvZ2luJyxcbiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgc3Vic2NyaWJlZCBvciB0cmlhbCBpcyBhY3RpdmVcbiAgICBjb25zdCBpc1N1YnNjcmliZWQgPSB1c2VyLmlzX3N1YnNjcmliZWQ7XG4gICAgXG4gICAgaWYgKGlzU3Vic2NyaWJlZCkge1xuICAgICAgLy8gVXNlciBpcyBzdWJzY3JpYmVkLCBhbGxvdyBhY2Nlc3NcbiAgICAgIHJldHVybiB7IFxuICAgICAgICBwcm9wczogeyBcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAuLi5zZXNzaW9uLnVzZXIsXG4gICAgICAgICAgICBpc1N1YnNjcmliZWQ6IHRydWUsXG4gICAgICAgICAgICB0cmlhbEFjdGl2ZTogdHJ1ZVxuICAgICAgICAgIH0gXG4gICAgICAgIH0gXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayB0cmlhbCBzdGF0dXNcbiAgICBjb25zdCB0cmlhbFN0YXJ0RGF0ZSA9IHVzZXIudHJpYWxfc3RhcnRfZGF0ZSA/IG5ldyBEYXRlKHVzZXIudHJpYWxfc3RhcnRfZGF0ZSkgOiBudWxsO1xuICAgIFxuICAgIGlmICghdHJpYWxTdGFydERhdGUpIHtcbiAgICAgIC8vIE5vIHRyaWFsIHN0YXJ0IGRhdGUsIHJlZGlyZWN0IHRvIHVwZ3JhZGVcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgICAgZGVzdGluYXRpb246ICcvdXBncmFkZScsXG4gICAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGF0ZSB0cmlhbCBlbmQgZGF0ZSBhbmQgY29tcGFyZSB3aXRoIGN1cnJlbnQgZGF0ZVxuICAgIGNvbnN0IHRyaWFsRW5kRGF0ZSA9IG5ldyBEYXRlKHRyaWFsU3RhcnREYXRlKTtcbiAgICB0cmlhbEVuZERhdGUuc2V0RGF0ZSh0cmlhbEVuZERhdGUuZ2V0RGF0ZSgpICsgNyk7XG4gICAgXG4gICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHRyaWFsQWN0aXZlID0gY3VycmVudERhdGUgPCB0cmlhbEVuZERhdGU7XG4gICAgXG4gICAgaWYgKCF0cmlhbEFjdGl2ZSkge1xuICAgICAgLy8gVHJpYWwgaGFzIGV4cGlyZWQsIHJlZGlyZWN0IHRvIHVwZ3JhZGUgcGFnZVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICBkZXN0aW5hdGlvbjogJy91cGdyYWRlJyxcbiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGRheXMgcmVtYWluaW5nIGluIHRyaWFsXG4gICAgY29uc3QgZGlmZlRpbWUgPSB0cmlhbEVuZERhdGUuZ2V0VGltZSgpIC0gY3VycmVudERhdGUuZ2V0VGltZSgpO1xuICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgICBjb25zdCBkYXlzUmVtYWluaW5nID0gTWF0aC5tYXgoMCwgZGlmZkRheXMpO1xuICAgIFxuICAgIC8vIFRyaWFsIGlzIGFjdGl2ZSwgYWxsb3cgYWNjZXNzIHdpdGggdHJpYWwgaW5mb1xuICAgIHJldHVybiB7IFxuICAgICAgcHJvcHM6IHsgXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAuLi5zZXNzaW9uLnVzZXIsXG4gICAgICAgICAgaXNTdWJzY3JpYmVkOiBmYWxzZSxcbiAgICAgICAgICB0cmlhbEFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICB0cmlhbEVuZERhdGU6IHRyaWFsRW5kRGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGRheXNSZW1haW5pbmdcbiAgICAgICAgfSBcbiAgICAgIH0gXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiByZXF1aXJlQXV0aGVudGljYXRpb246JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIE9uIGVycm9yLCBkZWZhdWx0IHRvIGFsbG93aW5nIGFjY2VzcyB3aXRoIHdhcm5pbmdcbiAgICAvLyBUaGlzIHByZXZlbnRzIGxvY2tlZC1vdXQgdXNlcnMgaW4gY2FzZSBvZiBkYXRhYmFzZSBlcnJvcnNcbiAgICByZXR1cm4geyBcbiAgICAgIHByb3BzOiB7IFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgLi4uc2Vzc2lvbi51c2VyLFxuICAgICAgICAgIGlzU3Vic2NyaWJlZDogZmFsc2UsXG4gICAgICAgICAgdHJpYWxBY3RpdmU6IHRydWUsXG4gICAgICAgICAgdHJpYWxTdGF0dXM6ICd1bmtub3duJyxcbiAgICAgICAgICBlcnJvcjogJ0NvdWxkIG5vdCB2ZXJpZnkgc3Vic2NyaXB0aW9uIHN0YXR1cydcbiAgICAgICAgfSBcbiAgICAgIH0gXG4gICAgfTtcbiAgfVxufSJdLCJuYW1lcyI6WyJnZXRTZXNzaW9uIiwiYmNyeXB0IiwiZ2V0RGF0YWJhc2UiLCJoYXNoUGFzc3dvcmQiLCJwYXNzd29yZCIsImhhc2giLCJ2ZXJpZnlQYXNzd29yZCIsImhhc2hlZFBhc3N3b3JkIiwiY29uc29sZSIsImxvZyIsInN1YnN0cmluZyIsImNvbXBhcmUiLCJlcnJvciIsImdldFVzZXJCeUVtYWlsIiwiZW1haWwiLCJkYiIsInVzZXIiLCJjb2xsZWN0aW9uIiwiZmluZE9uZSIsIl9pZCIsIkVycm9yIiwibWVzc2FnZSIsImNyZWF0ZVVzZXIiLCJ1c2VyRGF0YSIsIm5hbWUiLCJ0cmlhbF9zdGFydF9kYXRlIiwiaXNfc3Vic2NyaWJlZCIsInRyaWFsU3RhcnREYXRlIiwiRGF0ZSIsInVzZXJEb2MiLCJzcGxpdCIsImNyZWF0ZWRBdCIsImxhc3RMb2dpbiIsInJlc3VsdCIsImluc2VydE9uZSIsImluc2VydGVkSWQiLCJpZCIsInRvU3RyaW5nIiwiaXNBdXRoZW50aWNhdGVkIiwicmVxIiwicmVzIiwic2Vzc2lvbiIsInN0YXR1cyIsImpzb24iLCJpc1RyaWFsQWN0aXZlIiwidXNlcklkIiwidHJpYWxFbmREYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJjdXJyZW50RGF0ZSIsImdldFRyaWFsU3RhdHVzIiwiaXNBY3RpdmUiLCJpc1N1YnNjcmliZWQiLCJkYXlzUmVtYWluaW5nIiwiZGlmZlRpbWUiLCJnZXRUaW1lIiwiZGlmZkRheXMiLCJNYXRoIiwiY2VpbCIsIm1heCIsInVwZGF0ZVN1YnNjcmlwdGlvblN0YXR1cyIsInVwZGF0ZU9uZSIsIiRzZXQiLCJtb2RpZmllZENvdW50IiwicmVxdWlyZUF1dGhlbnRpY2F0aW9uIiwiY29udGV4dCIsInJlZGlyZWN0IiwiZGVzdGluYXRpb24iLCJwZXJtYW5lbnQiLCJwcm9wcyIsInRyaWFsQWN0aXZlIiwidG9JU09TdHJpbmciLCJ0cmlhbFN0YXR1cyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/auth.js\n");

/***/ }),

/***/ "(api-node)/./lib/mongodb.js":
/*!************************!*\
  !*** ./lib/mongodb.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DB_NAME: () => (/* binding */ DB_NAME),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getDatabase: () => (/* binding */ getDatabase)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\n// Database Name - change this if you want to use a different database\nconst DB_NAME = 'rehustle';\n// MongoDB connection config with several fallback options\n// This helps avoid SSL certificate issues and connection problems\nfunction getMongoConfig() {\n    // Main connection URI from env\n    const uri = process.env.MONGODB_URI;\n    if (!uri) {\n        console.error('MONGODB_URI not provided');\n        return {\n            uri: null,\n            options: {}\n        };\n    }\n    // Parse username and password from URI for diagnostics only\n    try {\n        // Extract credentials for logging (avoid logging actual credentials)\n        if (uri.includes('@')) {\n            const credentialPart = uri.split('@')[0].split('//')[1];\n            if (credentialPart && credentialPart.includes(':')) {\n                const username = credentialPart.split(':')[0];\n                console.log(`Using MongoDB with username: ${username}`);\n            }\n        }\n    } catch (error) {\n    // Ignore parsing errors\n    }\n    // For URI that uses SRV records\n    const isSrv = uri.includes('+srv');\n    // Start with most compatible options\n    const baseOptions = {\n        connectTimeoutMS: 30000,\n        serverSelectionTimeoutMS: 30000,\n        useNewUrlParser: true,\n        useUnifiedTopology: true\n    };\n    // Direct connection can sometimes bypass SSL issues\n    if (isSrv) {\n        console.log('Using MongoDB+SRV connection');\n        // Try to simplify the connection URI\n        let parsedUri = uri;\n        try {\n            // Strip query parameters and add back only essential ones\n            if (uri.includes('?')) {\n                parsedUri = uri.split('?')[0] + '?retryWrites=true&w=majority';\n                console.log('Simplified MongoDB connection string');\n            }\n        } catch (e) {\n            // Use original if parsing fails\n            console.error('Error parsing MongoDB URI:', e);\n            parsedUri = uri;\n        }\n        return {\n            uri: parsedUri,\n            options: {\n                ...baseOptions,\n                directConnection: false\n            }\n        };\n    } else {\n        // Standard connection\n        console.log('Using standard MongoDB connection');\n        return {\n            uri,\n            options: baseOptions\n        };\n    }\n}\n// Get connection configuration\nconst { uri, options } = getMongoConfig();\n// Check if MongoDB URI is configured\nif (!process.env.MONGODB_URI) {\n    throw new Error(\"Please define the MONGODB_URI environment variable.\");\n}\n// Global variables to cache the MongoDB connection promise\nlet client;\nlet clientPromise;\n// Create a connected client or a dummy client that fails gracefully\nasync function createClient() {\n    if (!uri) {\n        console.error(\"MongoDB URI is not provided\");\n        return null;\n    }\n    try {\n        const mongoClient = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        // Connect with timeout\n        const connectPromise = mongoClient.connect();\n        // Return the connected client or null if connection fails\n        return await connectPromise;\n    } catch (error) {\n        console.error(\"Failed to create MongoDB client:\", error);\n        return null;\n    }\n}\n// Setup the global promise for the MongoDB client\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    if (!global._mongoClientPromise) {\n        global._mongoClientPromise = createClient().catch((err)=>{\n            console.error(\"Failed to connect to MongoDB:\", err);\n            return null;\n        });\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\n/**\n * Helper function to get the MongoDB database\n * Includes fallback to in-memory storage if MongoDB is unavailable\n * @returns {Promise<Db>} MongoDB database or fallback object\n */ async function getDatabase() {\n    try {\n        // Await the client with a timeout\n        const client = await Promise.race([\n            clientPromise,\n            new Promise((_, reject)=>setTimeout(()=>reject(new Error('MongoDB connection timeout')), 5000))\n        ]);\n        // If client is null (connection failed), throw error to use fallback\n        if (!client) {\n            throw new Error(\"MongoDB client is null\");\n        }\n        // Return the database \n        return client.db(DB_NAME);\n    } catch (error) {\n        console.error(\"Error getting MongoDB database:\", error.message);\n        // Create a localStorage-backed fallback\n        return createLocalStorageFallbackDb();\n    }\n}\n/**\n * Creates an in-memory fallback database that uses localStorage when available\n * This allows the application to function without MongoDB\n * @returns {Object} Object that mimics MongoDB database API\n */ function createLocalStorageFallbackDb() {\n    // Use an in-memory store as fallback\n    console.warn(\"Using in-memory/localStorage fallback for database\");\n    // Collection data will be stored here in memory\n    const collections = {};\n    // Try to load existing data from localStorage or global memory\n    try {\n        const knownCollections = [\n            'users',\n            'deals',\n            'accounts',\n            'sessions'\n        ];\n        // Initialize collections\n        for (const collection of knownCollections){\n            collections[collection] = [];\n        }\n        // Client-side: Use localStorage\n        if (false) {} else if (typeof global !== 'undefined' && global._localDbStorage) {\n            for (const collection of knownCollections){\n                const storedData = global._localDbStorage[`rehustle_${collection}`];\n                if (storedData) {\n                    try {\n                        collections[collection] = JSON.parse(storedData);\n                        console.log(`Loaded ${collections[collection].length} items from server memory for ${collection}`);\n                    } catch (e) {\n                        console.error(`Failed to parse server memory data for ${collection}:`, e);\n                    }\n                }\n            }\n        }\n    } catch (e) {\n        console.error(\"Error accessing storage:\", e);\n    }\n    // Helper to save a collection to localStorage\n    const saveCollection = (name, data)=>{\n        try {\n            if (false) {} else if (typeof global !== 'undefined') {\n                // Server-side persistence for development/testing\n                if (!global._localDbStorage) {\n                    global._localDbStorage = {};\n                }\n                global._localDbStorage[`rehustle_${name}`] = JSON.stringify(data);\n            }\n        } catch (e) {\n            console.error(`Failed to save ${name} to localStorage:`, e);\n        }\n    };\n    // Return a MongoDB-like interface\n    return {\n        collection: (name)=>{\n            // Initialize collection if it doesn't exist\n            if (!collections[name]) {\n                collections[name] = [];\n            }\n            // Return a MongoDB-like collection interface\n            return {\n                findOne: async (query = {})=>{\n                    console.log(`[LocalDB] findOne in ${name}:`, query);\n                    const items = collections[name] || [];\n                    // Simple query matching\n                    if (query._id) {\n                        return items.find((item)=>item._id === query._id) || null;\n                    }\n                    // Match first item that has all query properties\n                    return items.find((item)=>{\n                        return Object.entries(query).every(([key, value])=>item[key] === value);\n                    }) || null;\n                },\n                find: (query = {})=>{\n                    console.log(`[LocalDB] find in ${name}:`, query);\n                    const items = collections[name] || [];\n                    // Filter items by query\n                    let results = items;\n                    if (Object.keys(query).length > 0) {\n                        results = items.filter((item)=>{\n                            return Object.entries(query).every(([key, value])=>item[key] === value);\n                        });\n                    }\n                    // Return a cursor-like object\n                    return {\n                        sort: (sortSpec)=>{\n                            // Simple sorting by a single field\n                            if (sortSpec && Object.keys(sortSpec).length > 0) {\n                                const [field, order] = Object.entries(sortSpec)[0];\n                                results.sort((a, b)=>{\n                                    if (a[field] < b[field]) return order === 1 ? -1 : 1;\n                                    if (a[field] > b[field]) return order === 1 ? 1 : -1;\n                                    return 0;\n                                });\n                            }\n                            return {\n                                toArray: async ()=>results\n                            };\n                        },\n                        toArray: async ()=>results\n                    };\n                },\n                insertOne: async (doc)=>{\n                    console.log(`[LocalDB] insertOne in ${name}:`, doc);\n                    // Generate an ID if none provided\n                    const newDoc = {\n                        ...doc,\n                        _id: doc._id || `local_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`\n                    };\n                    collections[name].push(newDoc);\n                    saveCollection(name, collections[name]);\n                    return {\n                        insertedId: newDoc._id,\n                        acknowledged: true\n                    };\n                },\n                deleteOne: async (filter)=>{\n                    console.log(`[LocalDB] deleteOne in ${name}:`, filter);\n                    const items = collections[name];\n                    const initialLength = items.length;\n                    // Remove the first matching item\n                    const index = items.findIndex((item)=>{\n                        return Object.entries(filter).every(([key, value])=>item[key] === value);\n                    });\n                    if (index !== -1) {\n                        items.splice(index, 1);\n                        saveCollection(name, items);\n                    }\n                    return {\n                        deletedCount: initialLength - items.length,\n                        acknowledged: true\n                    };\n                },\n                updateOne: async (filter, update)=>{\n                    console.log(`[LocalDB] updateOne in ${name}:`, filter, update);\n                    const items = collections[name];\n                    // Find the item to update\n                    const index = items.findIndex((item)=>{\n                        return Object.entries(filter).every(([key, value])=>item[key] === value);\n                    });\n                    if (index !== -1) {\n                        // Apply $set updates\n                        if (update.$set) {\n                            items[index] = {\n                                ...items[index],\n                                ...update.$set\n                            };\n                        }\n                        saveCollection(name, items);\n                        return {\n                            modifiedCount: 1,\n                            acknowledged: true\n                        };\n                    }\n                    return {\n                        modifiedCount: 0,\n                        acknowledged: true\n                    };\n                },\n                findOneAndUpdate: async (filter, update, options = {})=>{\n                    console.log(`[LocalDB] findOneAndUpdate in ${name}:`, filter, update, options);\n                    const items = collections[name];\n                    // Find the item to update\n                    const index = items.findIndex((item)=>{\n                        return Object.entries(filter).every(([key, value])=>item[key] === value);\n                    });\n                    let returnValue = null;\n                    if (index !== -1) {\n                        // Store the original value if returning before update\n                        if (!options.returnDocument || options.returnDocument === 'before') {\n                            returnValue = {\n                                ...items[index]\n                            };\n                        }\n                        // Apply $set updates\n                        if (update.$set) {\n                            items[index] = {\n                                ...items[index],\n                                ...update.$set\n                            };\n                        }\n                        // Store the updated value if returning after update\n                        if (options.returnDocument === 'after') {\n                            returnValue = {\n                                ...items[index]\n                            };\n                        }\n                        saveCollection(name, items);\n                    } else if (options.upsert) {\n                        // Create a new document if upsert is true\n                        const newDoc = {\n                            ...filter,\n                            ...update.$set,\n                            _id: `local_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`\n                        };\n                        items.push(newDoc);\n                        if (options.returnDocument === 'after') {\n                            returnValue = {\n                                ...newDoc\n                            };\n                        }\n                        saveCollection(name, items);\n                    }\n                    return {\n                        value: returnValue,\n                        ok: 1\n                    };\n                }\n            };\n        },\n        listCollections: ()=>({\n                toArray: async ()=>Object.keys(collections).map((name)=>({\n                            name\n                        }))\n            }),\n        command: async (cmd)=>{\n            // Simple support for ping command\n            if (cmd.ping) {\n                return {\n                    ok: 0\n                }; // Return 0 to indicate it's not a real MongoDB\n            }\n            return {\n                ok: 0\n            };\n        },\n        // Add a special method to indicate this is the fallback\n        isFallback: true\n    };\n}\n// Export clientPromise\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXNDO0FBRXRDLHNFQUFzRTtBQUMvRCxNQUFNQyxVQUFVLFdBQVc7QUFFbEMsMERBQTBEO0FBQzFELGtFQUFrRTtBQUNsRSxTQUFTQztJQUNQLCtCQUErQjtJQUMvQixNQUFNQyxNQUFNQyxRQUFRQyxHQUFHLENBQUNDLFdBQVc7SUFFbkMsSUFBSSxDQUFDSCxLQUFLO1FBQ1JJLFFBQVFDLEtBQUssQ0FBQztRQUNkLE9BQU87WUFBRUwsS0FBSztZQUFNTSxTQUFTLENBQUM7UUFBRTtJQUNsQztJQUVBLDREQUE0RDtJQUM1RCxJQUFJO1FBQ0YscUVBQXFFO1FBQ3JFLElBQUlOLElBQUlPLFFBQVEsQ0FBQyxNQUFNO1lBQ3JCLE1BQU1DLGlCQUFpQlIsSUFBSVMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUNBLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN2RCxJQUFJRCxrQkFBa0JBLGVBQWVELFFBQVEsQ0FBQyxNQUFNO2dCQUNsRCxNQUFNRyxXQUFXRixlQUFlQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQzdDTCxRQUFRTyxHQUFHLENBQUMsQ0FBQyw2QkFBNkIsRUFBRUQsVUFBVTtZQUN4RDtRQUNGO0lBQ0YsRUFBRSxPQUFPTCxPQUFPO0lBQ2Qsd0JBQXdCO0lBQzFCO0lBRUEsZ0NBQWdDO0lBQ2hDLE1BQU1PLFFBQVFaLElBQUlPLFFBQVEsQ0FBQztJQUUzQixxQ0FBcUM7SUFDckMsTUFBTU0sY0FBYztRQUNsQkMsa0JBQWtCO1FBQ2xCQywwQkFBMEI7UUFDMUJDLGlCQUFpQjtRQUNqQkMsb0JBQW9CO0lBQ3RCO0lBRUEsb0RBQW9EO0lBQ3BELElBQUlMLE9BQU87UUFDVFIsUUFBUU8sR0FBRyxDQUFDO1FBRVoscUNBQXFDO1FBQ3JDLElBQUlPLFlBQVlsQjtRQUNoQixJQUFJO1lBQ0YsMERBQTBEO1lBQzFELElBQUlBLElBQUlPLFFBQVEsQ0FBQyxNQUFNO2dCQUNyQlcsWUFBWWxCLElBQUlTLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHO2dCQUNoQ0wsUUFBUU8sR0FBRyxDQUFDO1lBQ2Q7UUFDRixFQUFFLE9BQU9RLEdBQUc7WUFDVixnQ0FBZ0M7WUFDaENmLFFBQVFDLEtBQUssQ0FBQyw4QkFBOEJjO1lBQzVDRCxZQUFZbEI7UUFDZDtRQUVBLE9BQU87WUFDTEEsS0FBS2tCO1lBQ0xaLFNBQVM7Z0JBQ1AsR0FBR08sV0FBVztnQkFDZE8sa0JBQWtCO1lBQ3BCO1FBQ0Y7SUFDRixPQUFPO1FBQ0wsc0JBQXNCO1FBQ3RCaEIsUUFBUU8sR0FBRyxDQUFDO1FBQ1osT0FBTztZQUNMWDtZQUNBTSxTQUFTTztRQUNYO0lBQ0Y7QUFDRjtBQUVBLCtCQUErQjtBQUMvQixNQUFNLEVBQUViLEdBQUcsRUFBRU0sT0FBTyxFQUFFLEdBQUdQO0FBRXpCLHFDQUFxQztBQUNyQyxJQUFJLENBQUNFLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVyxFQUFFO0lBQzVCLE1BQU0sSUFBSWtCLE1BQU07QUFDbEI7QUFFQSwyREFBMkQ7QUFDM0QsSUFBSUM7QUFDSixJQUFJQztBQUVKLG9FQUFvRTtBQUNwRSxlQUFlQztJQUNiLElBQUksQ0FBQ3hCLEtBQUs7UUFDUkksUUFBUUMsS0FBSyxDQUFDO1FBQ2QsT0FBTztJQUNUO0lBRUEsSUFBSTtRQUNGLE1BQU1vQixjQUFjLElBQUk1QixnREFBV0EsQ0FBQ0csS0FBS007UUFDekMsdUJBQXVCO1FBQ3ZCLE1BQU1vQixpQkFBaUJELFlBQVlFLE9BQU87UUFFMUMsMERBQTBEO1FBQzFELE9BQU8sTUFBTUQ7SUFDZixFQUFFLE9BQU9yQixPQUFPO1FBQ2RELFFBQVFDLEtBQUssQ0FBQyxvQ0FBb0NBO1FBQ2xELE9BQU87SUFDVDtBQUNGO0FBRUEsa0RBQWtEO0FBQ2xELElBQUlKLElBQXNDLEVBQUU7SUFDMUMsK0RBQStEO0lBQy9ELDZFQUE2RTtJQUM3RSxJQUFJLENBQUMyQixPQUFPQyxtQkFBbUIsRUFBRTtRQUMvQkQsT0FBT0MsbUJBQW1CLEdBQUdMLGVBQWVNLEtBQUssQ0FBQ0MsQ0FBQUE7WUFDaEQzQixRQUFRQyxLQUFLLENBQUMsaUNBQWlDMEI7WUFDL0MsT0FBTztRQUNUO0lBQ0Y7SUFDQVIsZ0JBQWdCSyxPQUFPQyxtQkFBbUI7QUFDNUMsT0FBTyxFQU1OO0FBRUQ7Ozs7Q0FJQyxHQUNNLGVBQWVHO0lBQ3BCLElBQUk7UUFDRixrQ0FBa0M7UUFDbEMsTUFBTVYsU0FBUyxNQUFNVyxRQUFRQyxJQUFJLENBQUM7WUFDaENYO1lBQ0EsSUFBSVUsUUFBUSxDQUFDRSxHQUFHQyxTQUNkQyxXQUFXLElBQU1ELE9BQU8sSUFBSWYsTUFBTSxnQ0FBZ0M7U0FFckU7UUFFRCxxRUFBcUU7UUFDckUsSUFBSSxDQUFDQyxRQUFRO1lBQ1gsTUFBTSxJQUFJRCxNQUFNO1FBQ2xCO1FBRUEsdUJBQXVCO1FBQ3ZCLE9BQU9DLE9BQU9nQixFQUFFLENBQUN4QztJQUNuQixFQUFFLE9BQU9PLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLG1DQUFtQ0EsTUFBTWtDLE9BQU87UUFFOUQsd0NBQXdDO1FBQ3hDLE9BQU9DO0lBQ1Q7QUFDRjtBQUVBOzs7O0NBSUMsR0FDRCxTQUFTQTtJQUNQLHFDQUFxQztJQUNyQ3BDLFFBQVFxQyxJQUFJLENBQUM7SUFFYixnREFBZ0Q7SUFDaEQsTUFBTUMsY0FBYyxDQUFDO0lBRXJCLCtEQUErRDtJQUMvRCxJQUFJO1FBQ0YsTUFBTUMsbUJBQW1CO1lBQUM7WUFBUztZQUFTO1lBQVk7U0FBVztRQUVuRSx5QkFBeUI7UUFDekIsS0FBSyxNQUFNQyxjQUFjRCxpQkFBa0I7WUFDekNELFdBQVcsQ0FBQ0UsV0FBVyxHQUFHLEVBQUU7UUFDOUI7UUFFQSxnQ0FBZ0M7UUFDaEMsSUFBSSxLQUFvRCxFQUFFLEVBWXpELE1BRUksSUFBSSxPQUFPaEIsV0FBVyxlQUFlQSxPQUFPd0IsZUFBZSxFQUFFO1lBQ2hFLEtBQUssTUFBTVIsY0FBY0QsaUJBQWtCO2dCQUN6QyxNQUFNSSxhQUFhbkIsT0FBT3dCLGVBQWUsQ0FBQyxDQUFDLFNBQVMsRUFBRVIsWUFBWSxDQUFDO2dCQUNuRSxJQUFJRyxZQUFZO29CQUNkLElBQUk7d0JBQ0ZMLFdBQVcsQ0FBQ0UsV0FBVyxHQUFHSyxLQUFLQyxLQUFLLENBQUNIO3dCQUNyQzNDLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRStCLFdBQVcsQ0FBQ0UsV0FBVyxDQUFDTyxNQUFNLENBQUMsOEJBQThCLEVBQUVQLFlBQVk7b0JBQ25HLEVBQUUsT0FBT3pCLEdBQUc7d0JBQ1ZmLFFBQVFDLEtBQUssQ0FBQyxDQUFDLHVDQUF1QyxFQUFFdUMsV0FBVyxDQUFDLENBQUMsRUFBRXpCO29CQUN6RTtnQkFDRjtZQUNGO1FBQ0Y7SUFDRixFQUFFLE9BQU9BLEdBQUc7UUFDVmYsUUFBUUMsS0FBSyxDQUFDLDRCQUE0QmM7SUFDNUM7SUFFQSw4Q0FBOEM7SUFDOUMsTUFBTWtDLGlCQUFpQixDQUFDQyxNQUFNQztRQUM1QixJQUFJO1lBQ0YsSUFBSSxLQUFvRCxFQUFFLEVBRXpELE1BQU0sSUFBSSxPQUFPM0IsV0FBVyxhQUFhO2dCQUN4QyxrREFBa0Q7Z0JBQ2xELElBQUksQ0FBQ0EsT0FBT3dCLGVBQWUsRUFBRTtvQkFDM0J4QixPQUFPd0IsZUFBZSxHQUFHLENBQUM7Z0JBQzVCO2dCQUNBeEIsT0FBT3dCLGVBQWUsQ0FBQyxDQUFDLFNBQVMsRUFBRUUsTUFBTSxDQUFDLEdBQUdMLEtBQUtRLFNBQVMsQ0FBQ0Y7WUFDOUQ7UUFDRixFQUFFLE9BQU9wQyxHQUFHO1lBQ1ZmLFFBQVFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsRUFBRWlELEtBQUssaUJBQWlCLENBQUMsRUFBRW5DO1FBQzNEO0lBQ0Y7SUFFQSxrQ0FBa0M7SUFDbEMsT0FBTztRQUNMeUIsWUFBWSxDQUFDVTtZQUNYLDRDQUE0QztZQUM1QyxJQUFJLENBQUNaLFdBQVcsQ0FBQ1ksS0FBSyxFQUFFO2dCQUN0QlosV0FBVyxDQUFDWSxLQUFLLEdBQUcsRUFBRTtZQUN4QjtZQUVBLDZDQUE2QztZQUM3QyxPQUFPO2dCQUNMSSxTQUFTLE9BQU9DLFFBQVEsQ0FBQyxDQUFDO29CQUN4QnZELFFBQVFPLEdBQUcsQ0FBQyxDQUFDLHFCQUFxQixFQUFFMkMsS0FBSyxDQUFDLENBQUMsRUFBRUs7b0JBQzdDLE1BQU1DLFFBQVFsQixXQUFXLENBQUNZLEtBQUssSUFBSSxFQUFFO29CQUVyQyx3QkFBd0I7b0JBQ3hCLElBQUlLLE1BQU1FLEdBQUcsRUFBRTt3QkFDYixPQUFPRCxNQUFNRSxJQUFJLENBQUNDLENBQUFBLE9BQVFBLEtBQUtGLEdBQUcsS0FBS0YsTUFBTUUsR0FBRyxLQUFLO29CQUN2RDtvQkFFQSxpREFBaUQ7b0JBQ2pELE9BQU9ELE1BQU1FLElBQUksQ0FBQ0MsQ0FBQUE7d0JBQ2hCLE9BQU9DLE9BQU9DLE9BQU8sQ0FBQ04sT0FBT08sS0FBSyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTSxHQUM5Q0wsSUFBSSxDQUFDSSxJQUFJLEtBQUtDO29CQUVsQixNQUFNO2dCQUNSO2dCQUVBTixNQUFNLENBQUNILFFBQVEsQ0FBQyxDQUFDO29CQUNmdkQsUUFBUU8sR0FBRyxDQUFDLENBQUMsa0JBQWtCLEVBQUUyQyxLQUFLLENBQUMsQ0FBQyxFQUFFSztvQkFDMUMsTUFBTUMsUUFBUWxCLFdBQVcsQ0FBQ1ksS0FBSyxJQUFJLEVBQUU7b0JBRXJDLHdCQUF3QjtvQkFDeEIsSUFBSWUsVUFBVVQ7b0JBQ2QsSUFBSUksT0FBT00sSUFBSSxDQUFDWCxPQUFPUixNQUFNLEdBQUcsR0FBRzt3QkFDakNrQixVQUFVVCxNQUFNVyxNQUFNLENBQUNSLENBQUFBOzRCQUNyQixPQUFPQyxPQUFPQyxPQUFPLENBQUNOLE9BQU9PLEtBQUssQ0FBQyxDQUFDLENBQUNDLEtBQUtDLE1BQU0sR0FDOUNMLElBQUksQ0FBQ0ksSUFBSSxLQUFLQzt3QkFFbEI7b0JBQ0Y7b0JBRUEsOEJBQThCO29CQUM5QixPQUFPO3dCQUNMSSxNQUFNLENBQUNDOzRCQUNMLG1DQUFtQzs0QkFDbkMsSUFBSUEsWUFBWVQsT0FBT00sSUFBSSxDQUFDRyxVQUFVdEIsTUFBTSxHQUFHLEdBQUc7Z0NBQ2hELE1BQU0sQ0FBQ3VCLE9BQU9DLE1BQU0sR0FBR1gsT0FBT0MsT0FBTyxDQUFDUSxTQUFTLENBQUMsRUFBRTtnQ0FDbERKLFFBQVFHLElBQUksQ0FBQyxDQUFDSSxHQUFHQztvQ0FDZixJQUFJRCxDQUFDLENBQUNGLE1BQU0sR0FBR0csQ0FBQyxDQUFDSCxNQUFNLEVBQUUsT0FBT0MsVUFBVSxJQUFJLENBQUMsSUFBSTtvQ0FDbkQsSUFBSUMsQ0FBQyxDQUFDRixNQUFNLEdBQUdHLENBQUMsQ0FBQ0gsTUFBTSxFQUFFLE9BQU9DLFVBQVUsSUFBSSxJQUFJLENBQUM7b0NBQ25ELE9BQU87Z0NBQ1Q7NEJBQ0Y7NEJBQ0EsT0FBTztnQ0FBRUcsU0FBUyxVQUFZVDs0QkFBUTt3QkFDeEM7d0JBQ0FTLFNBQVMsVUFBWVQ7b0JBQ3ZCO2dCQUNGO2dCQUVBVSxXQUFXLE9BQU9DO29CQUNoQjVFLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLHVCQUF1QixFQUFFMkMsS0FBSyxDQUFDLENBQUMsRUFBRTBCO29CQUMvQyxrQ0FBa0M7b0JBQ2xDLE1BQU1DLFNBQVM7d0JBQ2IsR0FBR0QsR0FBRzt3QkFDTm5CLEtBQUttQixJQUFJbkIsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFcUIsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUMsS0FBS0MsTUFBTSxHQUFHQyxRQUFRLENBQUMsSUFBSUMsU0FBUyxDQUFDLEdBQUcsSUFBSTtvQkFDckY7b0JBRUE3QyxXQUFXLENBQUNZLEtBQUssQ0FBQ2tDLElBQUksQ0FBQ1A7b0JBQ3ZCNUIsZUFBZUMsTUFBTVosV0FBVyxDQUFDWSxLQUFLO29CQUV0QyxPQUFPO3dCQUNMbUMsWUFBWVIsT0FBT3BCLEdBQUc7d0JBQ3RCNkIsY0FBYztvQkFDaEI7Z0JBQ0Y7Z0JBRUFDLFdBQVcsT0FBT3BCO29CQUNoQm5FLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLHVCQUF1QixFQUFFMkMsS0FBSyxDQUFDLENBQUMsRUFBRWlCO29CQUMvQyxNQUFNWCxRQUFRbEIsV0FBVyxDQUFDWSxLQUFLO29CQUMvQixNQUFNc0MsZ0JBQWdCaEMsTUFBTVQsTUFBTTtvQkFFbEMsaUNBQWlDO29CQUNqQyxNQUFNMEMsUUFBUWpDLE1BQU1rQyxTQUFTLENBQUMvQixDQUFBQTt3QkFDNUIsT0FBT0MsT0FBT0MsT0FBTyxDQUFDTSxRQUFRTCxLQUFLLENBQUMsQ0FBQyxDQUFDQyxLQUFLQyxNQUFNLEdBQy9DTCxJQUFJLENBQUNJLElBQUksS0FBS0M7b0JBRWxCO29CQUVBLElBQUl5QixVQUFVLENBQUMsR0FBRzt3QkFDaEJqQyxNQUFNbUMsTUFBTSxDQUFDRixPQUFPO3dCQUNwQnhDLGVBQWVDLE1BQU1NO29CQUN2QjtvQkFFQSxPQUFPO3dCQUNMb0MsY0FBY0osZ0JBQWdCaEMsTUFBTVQsTUFBTTt3QkFDMUN1QyxjQUFjO29CQUNoQjtnQkFDRjtnQkFFQU8sV0FBVyxPQUFPMUIsUUFBUTJCO29CQUN4QjlGLFFBQVFPLEdBQUcsQ0FBQyxDQUFDLHVCQUF1QixFQUFFMkMsS0FBSyxDQUFDLENBQUMsRUFBRWlCLFFBQVEyQjtvQkFDdkQsTUFBTXRDLFFBQVFsQixXQUFXLENBQUNZLEtBQUs7b0JBRS9CLDBCQUEwQjtvQkFDMUIsTUFBTXVDLFFBQVFqQyxNQUFNa0MsU0FBUyxDQUFDL0IsQ0FBQUE7d0JBQzVCLE9BQU9DLE9BQU9DLE9BQU8sQ0FBQ00sUUFBUUwsS0FBSyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTSxHQUMvQ0wsSUFBSSxDQUFDSSxJQUFJLEtBQUtDO29CQUVsQjtvQkFFQSxJQUFJeUIsVUFBVSxDQUFDLEdBQUc7d0JBQ2hCLHFCQUFxQjt3QkFDckIsSUFBSUssT0FBT0MsSUFBSSxFQUFFOzRCQUNmdkMsS0FBSyxDQUFDaUMsTUFBTSxHQUFHO2dDQUNiLEdBQUdqQyxLQUFLLENBQUNpQyxNQUFNO2dDQUNmLEdBQUdLLE9BQU9DLElBQUk7NEJBQ2hCO3dCQUNGO3dCQUVBOUMsZUFBZUMsTUFBTU07d0JBQ3JCLE9BQU87NEJBQ0x3QyxlQUFlOzRCQUNmVixjQUFjO3dCQUNoQjtvQkFDRjtvQkFFQSxPQUFPO3dCQUNMVSxlQUFlO3dCQUNmVixjQUFjO29CQUNoQjtnQkFDRjtnQkFFQVcsa0JBQWtCLE9BQU85QixRQUFRMkIsUUFBUTVGLFVBQVUsQ0FBQyxDQUFDO29CQUNuREYsUUFBUU8sR0FBRyxDQUFDLENBQUMsOEJBQThCLEVBQUUyQyxLQUFLLENBQUMsQ0FBQyxFQUFFaUIsUUFBUTJCLFFBQVE1RjtvQkFDdEUsTUFBTXNELFFBQVFsQixXQUFXLENBQUNZLEtBQUs7b0JBRS9CLDBCQUEwQjtvQkFDMUIsTUFBTXVDLFFBQVFqQyxNQUFNa0MsU0FBUyxDQUFDL0IsQ0FBQUE7d0JBQzVCLE9BQU9DLE9BQU9DLE9BQU8sQ0FBQ00sUUFBUUwsS0FBSyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTSxHQUMvQ0wsSUFBSSxDQUFDSSxJQUFJLEtBQUtDO29CQUVsQjtvQkFFQSxJQUFJa0MsY0FBYztvQkFFbEIsSUFBSVQsVUFBVSxDQUFDLEdBQUc7d0JBQ2hCLHNEQUFzRDt3QkFDdEQsSUFBSSxDQUFDdkYsUUFBUWlHLGNBQWMsSUFBSWpHLFFBQVFpRyxjQUFjLEtBQUssVUFBVTs0QkFDbEVELGNBQWM7Z0NBQUUsR0FBRzFDLEtBQUssQ0FBQ2lDLE1BQU07NEJBQUM7d0JBQ2xDO3dCQUVBLHFCQUFxQjt3QkFDckIsSUFBSUssT0FBT0MsSUFBSSxFQUFFOzRCQUNmdkMsS0FBSyxDQUFDaUMsTUFBTSxHQUFHO2dDQUNiLEdBQUdqQyxLQUFLLENBQUNpQyxNQUFNO2dDQUNmLEdBQUdLLE9BQU9DLElBQUk7NEJBQ2hCO3dCQUNGO3dCQUVBLG9EQUFvRDt3QkFDcEQsSUFBSTdGLFFBQVFpRyxjQUFjLEtBQUssU0FBUzs0QkFDdENELGNBQWM7Z0NBQUUsR0FBRzFDLEtBQUssQ0FBQ2lDLE1BQU07NEJBQUM7d0JBQ2xDO3dCQUVBeEMsZUFBZUMsTUFBTU07b0JBQ3ZCLE9BQU8sSUFBSXRELFFBQVFrRyxNQUFNLEVBQUU7d0JBQ3pCLDBDQUEwQzt3QkFDMUMsTUFBTXZCLFNBQVM7NEJBQ2IsR0FBR1YsTUFBTTs0QkFDVCxHQUFHMkIsT0FBT0MsSUFBSTs0QkFDZHRDLEtBQUssQ0FBQyxNQUFNLEVBQUVxQixLQUFLQyxHQUFHLEdBQUcsQ0FBQyxFQUFFQyxLQUFLQyxNQUFNLEdBQUdDLFFBQVEsQ0FBQyxJQUFJQyxTQUFTLENBQUMsR0FBRyxJQUFJO3dCQUMxRTt3QkFFQTNCLE1BQU00QixJQUFJLENBQUNQO3dCQUVYLElBQUkzRSxRQUFRaUcsY0FBYyxLQUFLLFNBQVM7NEJBQ3RDRCxjQUFjO2dDQUFFLEdBQUdyQixNQUFNOzRCQUFDO3dCQUM1Qjt3QkFFQTVCLGVBQWVDLE1BQU1NO29CQUN2QjtvQkFFQSxPQUFPO3dCQUNMUSxPQUFPa0M7d0JBQ1BHLElBQUk7b0JBQ047Z0JBQ0Y7WUFDRjtRQUNGO1FBRUFDLGlCQUFpQixJQUFPO2dCQUN0QjVCLFNBQVMsVUFBWWQsT0FBT00sSUFBSSxDQUFDNUIsYUFBYWlFLEdBQUcsQ0FBQ3JELENBQUFBLE9BQVM7NEJBQUVBO3dCQUFLO1lBQ3BFO1FBRUFzRCxTQUFTLE9BQU9DO1lBQ2Qsa0NBQWtDO1lBQ2xDLElBQUlBLElBQUlDLElBQUksRUFBRTtnQkFDWixPQUFPO29CQUFFTCxJQUFJO2dCQUFFLEdBQUcsK0NBQStDO1lBQ25FO1lBQ0EsT0FBTztnQkFBRUEsSUFBSTtZQUFFO1FBQ2pCO1FBRUEsd0RBQXdEO1FBQ3hETSxZQUFZO0lBQ2Q7QUFDRjtBQUVBLHVCQUF1QjtBQUN2QixpRUFBZXhGLGFBQWFBLEVBQUMiLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvbGliL21vbmdvZGIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tIFwibW9uZ29kYlwiO1xuXG4vLyBEYXRhYmFzZSBOYW1lIC0gY2hhbmdlIHRoaXMgaWYgeW91IHdhbnQgdG8gdXNlIGEgZGlmZmVyZW50IGRhdGFiYXNlXG5leHBvcnQgY29uc3QgREJfTkFNRSA9ICdyZWh1c3RsZSc7XG5cbi8vIE1vbmdvREIgY29ubmVjdGlvbiBjb25maWcgd2l0aCBzZXZlcmFsIGZhbGxiYWNrIG9wdGlvbnNcbi8vIFRoaXMgaGVscHMgYXZvaWQgU1NMIGNlcnRpZmljYXRlIGlzc3VlcyBhbmQgY29ubmVjdGlvbiBwcm9ibGVtc1xuZnVuY3Rpb24gZ2V0TW9uZ29Db25maWcoKSB7XG4gIC8vIE1haW4gY29ubmVjdGlvbiBVUkkgZnJvbSBlbnZcbiAgY29uc3QgdXJpID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkk7XG4gIFxuICBpZiAoIXVyaSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ01PTkdPREJfVVJJIG5vdCBwcm92aWRlZCcpO1xuICAgIHJldHVybiB7IHVyaTogbnVsbCwgb3B0aW9uczoge30gfTtcbiAgfVxuICBcbiAgLy8gUGFyc2UgdXNlcm5hbWUgYW5kIHBhc3N3b3JkIGZyb20gVVJJIGZvciBkaWFnbm9zdGljcyBvbmx5XG4gIHRyeSB7XG4gICAgLy8gRXh0cmFjdCBjcmVkZW50aWFscyBmb3IgbG9nZ2luZyAoYXZvaWQgbG9nZ2luZyBhY3R1YWwgY3JlZGVudGlhbHMpXG4gICAgaWYgKHVyaS5pbmNsdWRlcygnQCcpKSB7XG4gICAgICBjb25zdCBjcmVkZW50aWFsUGFydCA9IHVyaS5zcGxpdCgnQCcpWzBdLnNwbGl0KCcvLycpWzFdO1xuICAgICAgaWYgKGNyZWRlbnRpYWxQYXJ0ICYmIGNyZWRlbnRpYWxQYXJ0LmluY2x1ZGVzKCc6JykpIHtcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBjcmVkZW50aWFsUGFydC5zcGxpdCgnOicpWzBdO1xuICAgICAgICBjb25zb2xlLmxvZyhgVXNpbmcgTW9uZ29EQiB3aXRoIHVzZXJuYW1lOiAke3VzZXJuYW1lfWApO1xuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBJZ25vcmUgcGFyc2luZyBlcnJvcnNcbiAgfVxuICBcbiAgLy8gRm9yIFVSSSB0aGF0IHVzZXMgU1JWIHJlY29yZHNcbiAgY29uc3QgaXNTcnYgPSB1cmkuaW5jbHVkZXMoJytzcnYnKTtcbiAgXG4gIC8vIFN0YXJ0IHdpdGggbW9zdCBjb21wYXRpYmxlIG9wdGlvbnNcbiAgY29uc3QgYmFzZU9wdGlvbnMgPSB7XG4gICAgY29ubmVjdFRpbWVvdXRNUzogMzAwMDAsXG4gICAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiAzMDAwMCxcbiAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsIFxuICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZVxuICB9O1xuICBcbiAgLy8gRGlyZWN0IGNvbm5lY3Rpb24gY2FuIHNvbWV0aW1lcyBieXBhc3MgU1NMIGlzc3Vlc1xuICBpZiAoaXNTcnYpIHtcbiAgICBjb25zb2xlLmxvZygnVXNpbmcgTW9uZ29EQitTUlYgY29ubmVjdGlvbicpO1xuICAgIFxuICAgIC8vIFRyeSB0byBzaW1wbGlmeSB0aGUgY29ubmVjdGlvbiBVUklcbiAgICBsZXQgcGFyc2VkVXJpID0gdXJpO1xuICAgIHRyeSB7XG4gICAgICAvLyBTdHJpcCBxdWVyeSBwYXJhbWV0ZXJzIGFuZCBhZGQgYmFjayBvbmx5IGVzc2VudGlhbCBvbmVzXG4gICAgICBpZiAodXJpLmluY2x1ZGVzKCc/JykpIHtcbiAgICAgICAgcGFyc2VkVXJpID0gdXJpLnNwbGl0KCc/JylbMF0gKyAnP3JldHJ5V3JpdGVzPXRydWUmdz1tYWpvcml0eSc7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTaW1wbGlmaWVkIE1vbmdvREIgY29ubmVjdGlvbiBzdHJpbmcnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBVc2Ugb3JpZ2luYWwgaWYgcGFyc2luZyBmYWlsc1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBNb25nb0RCIFVSSTonLCBlKTtcbiAgICAgIHBhcnNlZFVyaSA9IHVyaTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHVyaTogcGFyc2VkVXJpLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICAuLi5iYXNlT3B0aW9ucyxcbiAgICAgICAgZGlyZWN0Q29ubmVjdGlvbjogZmFsc2VcbiAgICAgIH1cbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIC8vIFN0YW5kYXJkIGNvbm5lY3Rpb25cbiAgICBjb25zb2xlLmxvZygnVXNpbmcgc3RhbmRhcmQgTW9uZ29EQiBjb25uZWN0aW9uJyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVyaSxcbiAgICAgIG9wdGlvbnM6IGJhc2VPcHRpb25zXG4gICAgfTtcbiAgfVxufVxuXG4vLyBHZXQgY29ubmVjdGlvbiBjb25maWd1cmF0aW9uXG5jb25zdCB7IHVyaSwgb3B0aW9ucyB9ID0gZ2V0TW9uZ29Db25maWcoKTtcblxuLy8gQ2hlY2sgaWYgTW9uZ29EQiBVUkkgaXMgY29uZmlndXJlZFxuaWYgKCFwcm9jZXNzLmVudi5NT05HT0RCX1VSSSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSSBlbnZpcm9ubWVudCB2YXJpYWJsZS5cIik7XG59XG5cbi8vIEdsb2JhbCB2YXJpYWJsZXMgdG8gY2FjaGUgdGhlIE1vbmdvREIgY29ubmVjdGlvbiBwcm9taXNlXG5sZXQgY2xpZW50O1xubGV0IGNsaWVudFByb21pc2U7XG5cbi8vIENyZWF0ZSBhIGNvbm5lY3RlZCBjbGllbnQgb3IgYSBkdW1teSBjbGllbnQgdGhhdCBmYWlscyBncmFjZWZ1bGx5XG5hc3luYyBmdW5jdGlvbiBjcmVhdGVDbGllbnQoKSB7XG4gIGlmICghdXJpKSB7XG4gICAgY29uc29sZS5lcnJvcihcIk1vbmdvREIgVVJJIGlzIG5vdCBwcm92aWRlZFwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICBjb25zdCBtb25nb0NsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpO1xuICAgIC8vIENvbm5lY3Qgd2l0aCB0aW1lb3V0XG4gICAgY29uc3QgY29ubmVjdFByb21pc2UgPSBtb25nb0NsaWVudC5jb25uZWN0KCk7XG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSBjb25uZWN0ZWQgY2xpZW50IG9yIG51bGwgaWYgY29ubmVjdGlvbiBmYWlsc1xuICAgIHJldHVybiBhd2FpdCBjb25uZWN0UHJvbWlzZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBNb25nb0RCIGNsaWVudDpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIFNldHVwIHRoZSBnbG9iYWwgcHJvbWlzZSBmb3IgdGhlIE1vbmdvREIgY2xpZW50XG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIikge1xuICAvLyBJbiBkZXZlbG9wbWVudCBtb2RlLCB1c2UgYSBnbG9iYWwgdmFyaWFibGUgc28gdGhhdCB0aGUgdmFsdWVcbiAgLy8gaXMgcHJlc2VydmVkIGFjcm9zcyBtb2R1bGUgcmVsb2FkcyBjYXVzZWQgYnkgSE1SIChIb3QgTW9kdWxlIFJlcGxhY2VtZW50KS5cbiAgaWYgKCFnbG9iYWwuX21vbmdvQ2xpZW50UHJvbWlzZSkge1xuICAgIGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlID0gY3JlYXRlQ2xpZW50KCkuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCB0byBNb25nb0RCOlwiLCBlcnIpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSk7XG4gIH1cbiAgY2xpZW50UHJvbWlzZSA9IGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlO1xufSBlbHNlIHtcbiAgLy8gSW4gcHJvZHVjdGlvbiBtb2RlLCBpdCdzIGJlc3QgdG8gbm90IHVzZSBhIGdsb2JhbCB2YXJpYWJsZS5cbiAgY2xpZW50UHJvbWlzZSA9IGNyZWF0ZUNsaWVudCgpLmNhdGNoKGVyciA9PiB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjb25uZWN0IHRvIE1vbmdvREI6XCIsIGVycik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0pO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIE1vbmdvREIgZGF0YWJhc2VcbiAqIEluY2x1ZGVzIGZhbGxiYWNrIHRvIGluLW1lbW9yeSBzdG9yYWdlIGlmIE1vbmdvREIgaXMgdW5hdmFpbGFibGVcbiAqIEByZXR1cm5zIHtQcm9taXNlPERiPn0gTW9uZ29EQiBkYXRhYmFzZSBvciBmYWxsYmFjayBvYmplY3RcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERhdGFiYXNlKCkge1xuICB0cnkge1xuICAgIC8vIEF3YWl0IHRoZSBjbGllbnQgd2l0aCBhIHRpbWVvdXRcbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBQcm9taXNlLnJhY2UoW1xuICAgICAgY2xpZW50UHJvbWlzZSxcbiAgICAgIG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IFxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ01vbmdvREIgY29ubmVjdGlvbiB0aW1lb3V0JykpLCA1MDAwKVxuICAgICAgKVxuICAgIF0pO1xuICAgIFxuICAgIC8vIElmIGNsaWVudCBpcyBudWxsIChjb25uZWN0aW9uIGZhaWxlZCksIHRocm93IGVycm9yIHRvIHVzZSBmYWxsYmFja1xuICAgIGlmICghY2xpZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNb25nb0RCIGNsaWVudCBpcyBudWxsXCIpO1xuICAgIH1cbiAgICBcbiAgICAvLyBSZXR1cm4gdGhlIGRhdGFiYXNlIFxuICAgIHJldHVybiBjbGllbnQuZGIoREJfTkFNRSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGdldHRpbmcgTW9uZ29EQiBkYXRhYmFzZTpcIiwgZXJyb3IubWVzc2FnZSk7XG4gICAgXG4gICAgLy8gQ3JlYXRlIGEgbG9jYWxTdG9yYWdlLWJhY2tlZCBmYWxsYmFja1xuICAgIHJldHVybiBjcmVhdGVMb2NhbFN0b3JhZ2VGYWxsYmFja0RiKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluLW1lbW9yeSBmYWxsYmFjayBkYXRhYmFzZSB0aGF0IHVzZXMgbG9jYWxTdG9yYWdlIHdoZW4gYXZhaWxhYmxlXG4gKiBUaGlzIGFsbG93cyB0aGUgYXBwbGljYXRpb24gdG8gZnVuY3Rpb24gd2l0aG91dCBNb25nb0RCXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBPYmplY3QgdGhhdCBtaW1pY3MgTW9uZ29EQiBkYXRhYmFzZSBBUElcbiAqL1xuZnVuY3Rpb24gY3JlYXRlTG9jYWxTdG9yYWdlRmFsbGJhY2tEYigpIHtcbiAgLy8gVXNlIGFuIGluLW1lbW9yeSBzdG9yZSBhcyBmYWxsYmFja1xuICBjb25zb2xlLndhcm4oXCJVc2luZyBpbi1tZW1vcnkvbG9jYWxTdG9yYWdlIGZhbGxiYWNrIGZvciBkYXRhYmFzZVwiKTtcbiAgXG4gIC8vIENvbGxlY3Rpb24gZGF0YSB3aWxsIGJlIHN0b3JlZCBoZXJlIGluIG1lbW9yeVxuICBjb25zdCBjb2xsZWN0aW9ucyA9IHt9O1xuICBcbiAgLy8gVHJ5IHRvIGxvYWQgZXhpc3RpbmcgZGF0YSBmcm9tIGxvY2FsU3RvcmFnZSBvciBnbG9iYWwgbWVtb3J5XG4gIHRyeSB7XG4gICAgY29uc3Qga25vd25Db2xsZWN0aW9ucyA9IFsndXNlcnMnLCAnZGVhbHMnLCAnYWNjb3VudHMnLCAnc2Vzc2lvbnMnXTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIGNvbGxlY3Rpb25zXG4gICAgZm9yIChjb25zdCBjb2xsZWN0aW9uIG9mIGtub3duQ29sbGVjdGlvbnMpIHtcbiAgICAgIGNvbGxlY3Rpb25zW2NvbGxlY3Rpb25dID0gW107XG4gICAgfVxuICAgIFxuICAgIC8vIENsaWVudC1zaWRlOiBVc2UgbG9jYWxTdG9yYWdlXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgIGZvciAoY29uc3QgY29sbGVjdGlvbiBvZiBrbm93bkNvbGxlY3Rpb25zKSB7XG4gICAgICAgIGNvbnN0IHN0b3JlZERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgcmVodXN0bGVfJHtjb2xsZWN0aW9ufWApO1xuICAgICAgICBpZiAoc3RvcmVkRGF0YSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb2xsZWN0aW9uc1tjb2xsZWN0aW9uXSA9IEpTT04ucGFyc2Uoc3RvcmVkRGF0YSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGVkICR7Y29sbGVjdGlvbnNbY29sbGVjdGlvbl0ubGVuZ3RofSBpdGVtcyBmcm9tIGxvY2FsU3RvcmFnZSBmb3IgJHtjb2xsZWN0aW9ufWApO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwYXJzZSBsb2NhbFN0b3JhZ2UgZGF0YSBmb3IgJHtjb2xsZWN0aW9ufTpgLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IFxuICAgIC8vIFNlcnZlci1zaWRlOiBVc2UgZ2xvYmFsIG9iamVjdCBmb3IgcGVyc2lzdGVuY2UgYmV0d2VlbiByZXF1ZXN0c1xuICAgIGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbC5fbG9jYWxEYlN0b3JhZ2UpIHtcbiAgICAgIGZvciAoY29uc3QgY29sbGVjdGlvbiBvZiBrbm93bkNvbGxlY3Rpb25zKSB7XG4gICAgICAgIGNvbnN0IHN0b3JlZERhdGEgPSBnbG9iYWwuX2xvY2FsRGJTdG9yYWdlW2ByZWh1c3RsZV8ke2NvbGxlY3Rpb259YF07XG4gICAgICAgIGlmIChzdG9yZWREYXRhKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb25zW2NvbGxlY3Rpb25dID0gSlNPTi5wYXJzZShzdG9yZWREYXRhKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHtjb2xsZWN0aW9uc1tjb2xsZWN0aW9uXS5sZW5ndGh9IGl0ZW1zIGZyb20gc2VydmVyIG1lbW9yeSBmb3IgJHtjb2xsZWN0aW9ufWApO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwYXJzZSBzZXJ2ZXIgbWVtb3J5IGRhdGEgZm9yICR7Y29sbGVjdGlvbn06YCwgZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGFjY2Vzc2luZyBzdG9yYWdlOlwiLCBlKTtcbiAgfVxuICBcbiAgLy8gSGVscGVyIHRvIHNhdmUgYSBjb2xsZWN0aW9uIHRvIGxvY2FsU3RvcmFnZVxuICBjb25zdCBzYXZlQ29sbGVjdGlvbiA9IChuYW1lLCBkYXRhKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGByZWh1c3RsZV8ke25hbWV9YCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAvLyBTZXJ2ZXItc2lkZSBwZXJzaXN0ZW5jZSBmb3IgZGV2ZWxvcG1lbnQvdGVzdGluZ1xuICAgICAgICBpZiAoIWdsb2JhbC5fbG9jYWxEYlN0b3JhZ2UpIHtcbiAgICAgICAgICBnbG9iYWwuX2xvY2FsRGJTdG9yYWdlID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZ2xvYmFsLl9sb2NhbERiU3RvcmFnZVtgcmVodXN0bGVfJHtuYW1lfWBdID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHNhdmUgJHtuYW1lfSB0byBsb2NhbFN0b3JhZ2U6YCwgZSk7XG4gICAgfVxuICB9O1xuICBcbiAgLy8gUmV0dXJuIGEgTW9uZ29EQi1saWtlIGludGVyZmFjZVxuICByZXR1cm4ge1xuICAgIGNvbGxlY3Rpb246IChuYW1lKSA9PiB7XG4gICAgICAvLyBJbml0aWFsaXplIGNvbGxlY3Rpb24gaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgaWYgKCFjb2xsZWN0aW9uc1tuYW1lXSkge1xuICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXSA9IFtdO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBSZXR1cm4gYSBNb25nb0RCLWxpa2UgY29sbGVjdGlvbiBpbnRlcmZhY2VcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZpbmRPbmU6IGFzeW5jIChxdWVyeSA9IHt9KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtMb2NhbERCXSBmaW5kT25lIGluICR7bmFtZX06YCwgcXVlcnkpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gY29sbGVjdGlvbnNbbmFtZV0gfHwgW107XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2ltcGxlIHF1ZXJ5IG1hdGNoaW5nXG4gICAgICAgICAgaWYgKHF1ZXJ5Ll9pZCkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLl9pZCA9PT0gcXVlcnkuX2lkKSB8fCBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBNYXRjaCBmaXJzdCBpdGVtIHRoYXQgaGFzIGFsbCBxdWVyeSBwcm9wZXJ0aWVzXG4gICAgICAgICAgcmV0dXJuIGl0ZW1zLmZpbmQoaXRlbSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocXVlcnkpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IFxuICAgICAgICAgICAgICBpdGVtW2tleV0gPT09IHZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pIHx8IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBmaW5kOiAocXVlcnkgPSB7fSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTG9jYWxEQl0gZmluZCBpbiAke25hbWV9OmAsIHF1ZXJ5KTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGNvbGxlY3Rpb25zW25hbWVdIHx8IFtdO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZpbHRlciBpdGVtcyBieSBxdWVyeVxuICAgICAgICAgIGxldCByZXN1bHRzID0gaXRlbXM7XG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHF1ZXJ5KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXN1bHRzID0gaXRlbXMuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocXVlcnkpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IFxuICAgICAgICAgICAgICAgIGl0ZW1ba2V5XSA9PT0gdmFsdWVcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZXR1cm4gYSBjdXJzb3ItbGlrZSBvYmplY3RcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc29ydDogKHNvcnRTcGVjKSA9PiB7XG4gICAgICAgICAgICAgIC8vIFNpbXBsZSBzb3J0aW5nIGJ5IGEgc2luZ2xlIGZpZWxkXG4gICAgICAgICAgICAgIGlmIChzb3J0U3BlYyAmJiBPYmplY3Qua2V5cyhzb3J0U3BlYykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IFtmaWVsZCwgb3JkZXJdID0gT2JqZWN0LmVudHJpZXMoc29ydFNwZWMpWzBdO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKGFbZmllbGRdIDwgYltmaWVsZF0pIHJldHVybiBvcmRlciA9PT0gMSA/IC0xIDogMTtcbiAgICAgICAgICAgICAgICAgIGlmIChhW2ZpZWxkXSA+IGJbZmllbGRdKSByZXR1cm4gb3JkZXIgPT09IDEgPyAxIDogLTE7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4geyB0b0FycmF5OiBhc3luYyAoKSA9PiByZXN1bHRzIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9BcnJheTogYXN5bmMgKCkgPT4gcmVzdWx0c1xuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBpbnNlcnRPbmU6IGFzeW5jIChkb2MpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW0xvY2FsREJdIGluc2VydE9uZSBpbiAke25hbWV9OmAsIGRvYyk7XG4gICAgICAgICAgLy8gR2VuZXJhdGUgYW4gSUQgaWYgbm9uZSBwcm92aWRlZFxuICAgICAgICAgIGNvbnN0IG5ld0RvYyA9IHsgXG4gICAgICAgICAgICAuLi5kb2MsIFxuICAgICAgICAgICAgX2lkOiBkb2MuX2lkIHx8IGBsb2NhbF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWBcbiAgICAgICAgICB9O1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbGxlY3Rpb25zW25hbWVdLnB1c2gobmV3RG9jKTtcbiAgICAgICAgICBzYXZlQ29sbGVjdGlvbihuYW1lLCBjb2xsZWN0aW9uc1tuYW1lXSk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICBpbnNlcnRlZElkOiBuZXdEb2MuX2lkLFxuICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0cnVlXG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGRlbGV0ZU9uZTogYXN5bmMgKGZpbHRlcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTG9jYWxEQl0gZGVsZXRlT25lIGluICR7bmFtZX06YCwgZmlsdGVyKTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGNvbGxlY3Rpb25zW25hbWVdO1xuICAgICAgICAgIGNvbnN0IGluaXRpYWxMZW5ndGggPSBpdGVtcy5sZW5ndGg7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBtYXRjaGluZyBpdGVtXG4gICAgICAgICAgY29uc3QgaW5kZXggPSBpdGVtcy5maW5kSW5kZXgoaXRlbSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZmlsdGVyKS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiBcbiAgICAgICAgICAgICAgaXRlbVtrZXldID09PSB2YWx1ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBpdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgc2F2ZUNvbGxlY3Rpb24obmFtZSwgaXRlbXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgIGRlbGV0ZWRDb3VudDogaW5pdGlhbExlbmd0aCAtIGl0ZW1zLmxlbmd0aCxcbiAgICAgICAgICAgIGFja25vd2xlZGdlZDogdHJ1ZVxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICB1cGRhdGVPbmU6IGFzeW5jIChmaWx0ZXIsIHVwZGF0ZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTG9jYWxEQl0gdXBkYXRlT25lIGluICR7bmFtZX06YCwgZmlsdGVyLCB1cGRhdGUpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gY29sbGVjdGlvbnNbbmFtZV07XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRmluZCB0aGUgaXRlbSB0byB1cGRhdGVcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGl0ZW1zLmZpbmRJbmRleChpdGVtID0+IHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyhmaWx0ZXIpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IFxuICAgICAgICAgICAgICBpdGVtW2tleV0gPT09IHZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIC8vIEFwcGx5ICRzZXQgdXBkYXRlc1xuICAgICAgICAgICAgaWYgKHVwZGF0ZS4kc2V0KSB7XG4gICAgICAgICAgICAgIGl0ZW1zW2luZGV4XSA9IHsgXG4gICAgICAgICAgICAgICAgLi4uaXRlbXNbaW5kZXhdLCBcbiAgICAgICAgICAgICAgICAuLi51cGRhdGUuJHNldCBcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc2F2ZUNvbGxlY3Rpb24obmFtZSwgaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IDEsXG4gICAgICAgICAgICAgIGFja25vd2xlZGdlZDogdHJ1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgICBtb2RpZmllZENvdW50OiAwLFxuICAgICAgICAgICAgYWNrbm93bGVkZ2VkOiB0cnVlXG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGZpbmRPbmVBbmRVcGRhdGU6IGFzeW5jIChmaWx0ZXIsIHVwZGF0ZSwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtMb2NhbERCXSBmaW5kT25lQW5kVXBkYXRlIGluICR7bmFtZX06YCwgZmlsdGVyLCB1cGRhdGUsIG9wdGlvbnMpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gY29sbGVjdGlvbnNbbmFtZV07XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRmluZCB0aGUgaXRlbSB0byB1cGRhdGVcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGl0ZW1zLmZpbmRJbmRleChpdGVtID0+IHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyhmaWx0ZXIpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IFxuICAgICAgICAgICAgICBpdGVtW2tleV0gPT09IHZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGxldCByZXR1cm5WYWx1ZSA9IG51bGw7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgLy8gU3RvcmUgdGhlIG9yaWdpbmFsIHZhbHVlIGlmIHJldHVybmluZyBiZWZvcmUgdXBkYXRlXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMucmV0dXJuRG9jdW1lbnQgfHwgb3B0aW9ucy5yZXR1cm5Eb2N1bWVudCA9PT0gJ2JlZm9yZScpIHtcbiAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB7IC4uLml0ZW1zW2luZGV4XSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBcHBseSAkc2V0IHVwZGF0ZXNcbiAgICAgICAgICAgIGlmICh1cGRhdGUuJHNldCkge1xuICAgICAgICAgICAgICBpdGVtc1tpbmRleF0gPSB7IFxuICAgICAgICAgICAgICAgIC4uLml0ZW1zW2luZGV4XSwgXG4gICAgICAgICAgICAgICAgLi4udXBkYXRlLiRzZXQgXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFN0b3JlIHRoZSB1cGRhdGVkIHZhbHVlIGlmIHJldHVybmluZyBhZnRlciB1cGRhdGVcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJldHVybkRvY3VtZW50ID09PSAnYWZ0ZXInKSB7XG4gICAgICAgICAgICAgIHJldHVyblZhbHVlID0geyAuLi5pdGVtc1tpbmRleF0gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc2F2ZUNvbGxlY3Rpb24obmFtZSwgaXRlbXMpO1xuICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy51cHNlcnQpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyBkb2N1bWVudCBpZiB1cHNlcnQgaXMgdHJ1ZVxuICAgICAgICAgICAgY29uc3QgbmV3RG9jID0geyBcbiAgICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgICAuLi51cGRhdGUuJHNldCxcbiAgICAgICAgICAgICAgX2lkOiBgbG9jYWxfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA5KX1gXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpdGVtcy5wdXNoKG5ld0RvYyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJldHVybkRvY3VtZW50ID09PSAnYWZ0ZXInKSB7XG4gICAgICAgICAgICAgIHJldHVyblZhbHVlID0geyAuLi5uZXdEb2MgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc2F2ZUNvbGxlY3Rpb24obmFtZSwgaXRlbXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgIHZhbHVlOiByZXR1cm5WYWx1ZSxcbiAgICAgICAgICAgIG9rOiAxXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIFxuICAgIGxpc3RDb2xsZWN0aW9uczogKCkgPT4gKHtcbiAgICAgIHRvQXJyYXk6IGFzeW5jICgpID0+IE9iamVjdC5rZXlzKGNvbGxlY3Rpb25zKS5tYXAobmFtZSA9PiAoeyBuYW1lIH0pKVxuICAgIH0pLFxuICAgIFxuICAgIGNvbW1hbmQ6IGFzeW5jIChjbWQpID0+IHtcbiAgICAgIC8vIFNpbXBsZSBzdXBwb3J0IGZvciBwaW5nIGNvbW1hbmRcbiAgICAgIGlmIChjbWQucGluZykge1xuICAgICAgICByZXR1cm4geyBvazogMCB9OyAvLyBSZXR1cm4gMCB0byBpbmRpY2F0ZSBpdCdzIG5vdCBhIHJlYWwgTW9uZ29EQlxuICAgICAgfVxuICAgICAgcmV0dXJuIHsgb2s6IDAgfTtcbiAgICB9LFxuICAgIFxuICAgIC8vIEFkZCBhIHNwZWNpYWwgbWV0aG9kIHRvIGluZGljYXRlIHRoaXMgaXMgdGhlIGZhbGxiYWNrXG4gICAgaXNGYWxsYmFjazogdHJ1ZVxuICB9O1xufVxuXG4vLyBFeHBvcnQgY2xpZW50UHJvbWlzZVxuZXhwb3J0IGRlZmF1bHQgY2xpZW50UHJvbWlzZTsiXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJEQl9OQU1FIiwiZ2V0TW9uZ29Db25maWciLCJ1cmkiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJjb25zb2xlIiwiZXJyb3IiLCJvcHRpb25zIiwiaW5jbHVkZXMiLCJjcmVkZW50aWFsUGFydCIsInNwbGl0IiwidXNlcm5hbWUiLCJsb2ciLCJpc1NydiIsImJhc2VPcHRpb25zIiwiY29ubmVjdFRpbWVvdXRNUyIsInNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyIsInVzZU5ld1VybFBhcnNlciIsInVzZVVuaWZpZWRUb3BvbG9neSIsInBhcnNlZFVyaSIsImUiLCJkaXJlY3RDb25uZWN0aW9uIiwiRXJyb3IiLCJjbGllbnQiLCJjbGllbnRQcm9taXNlIiwiY3JlYXRlQ2xpZW50IiwibW9uZ29DbGllbnQiLCJjb25uZWN0UHJvbWlzZSIsImNvbm5lY3QiLCJnbG9iYWwiLCJfbW9uZ29DbGllbnRQcm9taXNlIiwiY2F0Y2giLCJlcnIiLCJnZXREYXRhYmFzZSIsIlByb21pc2UiLCJyYWNlIiwiXyIsInJlamVjdCIsInNldFRpbWVvdXQiLCJkYiIsIm1lc3NhZ2UiLCJjcmVhdGVMb2NhbFN0b3JhZ2VGYWxsYmFja0RiIiwid2FybiIsImNvbGxlY3Rpb25zIiwia25vd25Db2xsZWN0aW9ucyIsImNvbGxlY3Rpb24iLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJzdG9yZWREYXRhIiwiZ2V0SXRlbSIsIkpTT04iLCJwYXJzZSIsImxlbmd0aCIsIl9sb2NhbERiU3RvcmFnZSIsInNhdmVDb2xsZWN0aW9uIiwibmFtZSIsImRhdGEiLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiZmluZE9uZSIsInF1ZXJ5IiwiaXRlbXMiLCJfaWQiLCJmaW5kIiwiaXRlbSIsIk9iamVjdCIsImVudHJpZXMiLCJldmVyeSIsImtleSIsInZhbHVlIiwicmVzdWx0cyIsImtleXMiLCJmaWx0ZXIiLCJzb3J0Iiwic29ydFNwZWMiLCJmaWVsZCIsIm9yZGVyIiwiYSIsImIiLCJ0b0FycmF5IiwiaW5zZXJ0T25lIiwiZG9jIiwibmV3RG9jIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsInB1c2giLCJpbnNlcnRlZElkIiwiYWNrbm93bGVkZ2VkIiwiZGVsZXRlT25lIiwiaW5pdGlhbExlbmd0aCIsImluZGV4IiwiZmluZEluZGV4Iiwic3BsaWNlIiwiZGVsZXRlZENvdW50IiwidXBkYXRlT25lIiwidXBkYXRlIiwiJHNldCIsIm1vZGlmaWVkQ291bnQiLCJmaW5kT25lQW5kVXBkYXRlIiwicmV0dXJuVmFsdWUiLCJyZXR1cm5Eb2N1bWVudCIsInVwc2VydCIsIm9rIiwibGlzdENvbGxlY3Rpb25zIiwibWFwIiwiY29tbWFuZCIsImNtZCIsInBpbmciLCJpc0ZhbGxiYWNrIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/auth/[...nextauth].js */ \"(api-node)/./pages/api/auth/[...nextauth].js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth/[...nextauth]\",\n        pathname: \"/api/auth/[...nextauth]\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_auth_nextauth_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYXV0aCUyRiU1Qi4uLm5leHRhdXRoJTVEJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZhdXRoJTJGJTVCLi4ubmV4dGF1dGglNUQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDOEQ7QUFDOUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0uanNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvWy4uLm5leHRhdXRoXVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvWy4uLm5leHRhdXRoXVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/auth/[...nextauth].js":
/*!*****************************************!*\
  !*** ./pages/api/auth/[...nextauth].js ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"next-auth\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"next-auth/providers/credentials\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _next_auth_mongodb_adapter__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @next-auth/mongodb-adapter */ \"@next-auth/mongodb-adapter\");\n/* harmony import */ var _next_auth_mongodb_adapter__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_next_auth_mongodb_adapter__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../lib/auth */ \"(api-node)/./lib/auth.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_auth__WEBPACK_IMPORTED_MODULE_4__]);\n_lib_auth__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n// Let's simplify our approach and make NextAuth more resilient\n// We'll avoid complex setup that could throw errors\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (next_auth__WEBPACK_IMPORTED_MODULE_0___default()({\n    // Add adapter only if it's available in a try/catch\n    ...(()=>{\n        try {\n            return {\n                adapter: (0,_next_auth_mongodb_adapter__WEBPACK_IMPORTED_MODULE_2__.MongoDBAdapter)(_lib_mongodb__WEBPACK_IMPORTED_MODULE_3__[\"default\"])\n            };\n        } catch (e) {\n            console.warn(\"MongoDB adapter initialization failed, falling back to JWT only\");\n            return {}; // No adapter if MongoDB is unavailable\n        }\n    })(),\n    providers: [\n        next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default()({\n            name: \"Credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"text\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials) {\n                    console.error('No credentials provided');\n                    return null;\n                }\n                const { email, password } = credentials;\n                if (!email || !password) {\n                    console.error('Missing email or password');\n                    return null;\n                }\n                try {\n                    console.log(`Attempting to authorize: ${email}`);\n                    // Try to create test user if they don't exist\n                    if (email === 'test@example.com' && password === 'password123') {\n                        try {\n                            const existingUser = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.getUserByEmail)(email);\n                            if (!existingUser) {\n                                console.log('Creating test user since it does not exist');\n                                const testUser = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.createUser)({\n                                    email: 'test@example.com',\n                                    password: 'password123',\n                                    name: 'Test User',\n                                    trial_start_date: new Date().toISOString(),\n                                    is_subscribed: false\n                                });\n                                console.log(`Test user created with ID: ${testUser.id}`);\n                                // Return the newly created test user\n                                return {\n                                    id: testUser.id,\n                                    email: testUser.email,\n                                    name: testUser.name,\n                                    userId: testUser.id\n                                };\n                            }\n                        } catch (e) {\n                            console.error('Error checking/creating test user:', e);\n                        }\n                    }\n                    // Fetch the user from MongoDB/fallback storage\n                    const user = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.getUserByEmail)(email);\n                    if (!user) {\n                        console.log(`No user found with email: ${email}`);\n                        return null;\n                    }\n                    console.log(`User found: ${user.email}, ID: ${user._id}, verifying password`);\n                    // Verify the password\n                    const isValid = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_4__.verifyPassword)(password, user.password);\n                    if (!isValid) {\n                        console.log('Invalid password');\n                        return null;\n                    }\n                    console.log('Password verified successfully');\n                    // Convert ID to string if it's an object\n                    const userId = typeof user._id === 'object' ? user._id.toString() : user._id;\n                    // Return a user object excluding the password\n                    return {\n                        id: userId,\n                        email: user.email,\n                        name: user.name || '',\n                        userId: userId\n                    };\n                } catch (error) {\n                    console.error('Error in authorize:', error);\n                    // Don't throw, return null instead to show the error on the login form\n                    return null;\n                }\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.id = user.id;\n                token.userId = user.id; // Ensure userId is in the token\n                token.name = user.name;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token) {\n                session.user.id = token.id;\n                session.user.userId = token.id; // Add userId to session for consistency\n                if (token.name) {\n                    session.user.name = token.name;\n                }\n            }\n            return session;\n        }\n    },\n    pages: {\n        signIn: \"/login\",\n        error: \"/login\",\n        newUser: \"/dashboard\"\n    },\n    secret: process.env.NEXTAUTH_SECRET || \"a-strong-secret-for-development-only\",\n    debug: \"development\" === 'development'\n}));\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQWlDO0FBQ2lDO0FBQ047QUFDWDtBQUM4QjtBQUUvRSwrREFBK0Q7QUFDL0Qsb0RBQW9EO0FBQ3BELGlFQUFlQSxnREFBUUEsQ0FBQztJQUN0QixvREFBb0Q7SUFDcEQsR0FBRyxDQUFDO1FBQ0YsSUFBSTtZQUNGLE9BQU87Z0JBQUVPLFNBQVNMLDBFQUFjQSxDQUFDQyxvREFBYUE7WUFBRTtRQUNsRCxFQUFFLE9BQU9LLEdBQUc7WUFDVkMsUUFBUUMsSUFBSSxDQUFDO1lBQ2IsT0FBTyxDQUFDLEdBQUcsdUNBQXVDO1FBQ3BEO0lBQ0YsSUFBSTtJQUNKQyxXQUFXO1FBQ1RWLHNFQUFtQkEsQ0FBQztZQUNsQlcsTUFBTTtZQUNOQyxhQUFhO2dCQUNYQyxPQUFPO29CQUFFQyxPQUFPO29CQUFTQyxNQUFNO2dCQUFPO2dCQUN0Q0MsVUFBVTtvQkFBRUYsT0FBTztvQkFBWUMsTUFBTTtnQkFBVztZQUNsRDtZQUNBLE1BQU1FLFdBQVVMLFdBQVc7Z0JBQ3pCLElBQUksQ0FBQ0EsYUFBYTtvQkFDaEJKLFFBQVFVLEtBQUssQ0FBQztvQkFDZCxPQUFPO2dCQUNUO2dCQUVBLE1BQU0sRUFBRUwsS0FBSyxFQUFFRyxRQUFRLEVBQUUsR0FBR0o7Z0JBRTVCLElBQUksQ0FBQ0MsU0FBUyxDQUFDRyxVQUFVO29CQUN2QlIsUUFBUVUsS0FBSyxDQUFDO29CQUNkLE9BQU87Z0JBQ1Q7Z0JBRUEsSUFBSTtvQkFDRlYsUUFBUVcsR0FBRyxDQUFDLENBQUMseUJBQXlCLEVBQUVOLE9BQU87b0JBRS9DLDhDQUE4QztvQkFDOUMsSUFBSUEsVUFBVSxzQkFBc0JHLGFBQWEsZUFBZTt3QkFDOUQsSUFBSTs0QkFDRixNQUFNSSxlQUFlLE1BQU1qQix5REFBY0EsQ0FBQ1U7NEJBRTFDLElBQUksQ0FBQ08sY0FBYztnQ0FDakJaLFFBQVFXLEdBQUcsQ0FBQztn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aF0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE5leHRBdXRoIGZyb20gXCJuZXh0LWF1dGhcIjtcbmltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gXCJuZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzXCI7XG5pbXBvcnQgeyBNb25nb0RCQWRhcHRlciB9IGZyb20gXCJAbmV4dC1hdXRoL21vbmdvZGItYWRhcHRlclwiO1xuaW1wb3J0IGNsaWVudFByb21pc2UgZnJvbSBcIi4uLy4uLy4uL2xpYi9tb25nb2RiXCI7XG5pbXBvcnQgeyBnZXRVc2VyQnlFbWFpbCwgdmVyaWZ5UGFzc3dvcmQsIGNyZWF0ZVVzZXIgfSBmcm9tIFwiLi4vLi4vLi4vbGliL2F1dGhcIjtcblxuLy8gTGV0J3Mgc2ltcGxpZnkgb3VyIGFwcHJvYWNoIGFuZCBtYWtlIE5leHRBdXRoIG1vcmUgcmVzaWxpZW50XG4vLyBXZSdsbCBhdm9pZCBjb21wbGV4IHNldHVwIHRoYXQgY291bGQgdGhyb3cgZXJyb3JzXG5leHBvcnQgZGVmYXVsdCBOZXh0QXV0aCh7XG4gIC8vIEFkZCBhZGFwdGVyIG9ubHkgaWYgaXQncyBhdmFpbGFibGUgaW4gYSB0cnkvY2F0Y2hcbiAgLi4uKCgpID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHsgYWRhcHRlcjogTW9uZ29EQkFkYXB0ZXIoY2xpZW50UHJvbWlzZSkgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJNb25nb0RCIGFkYXB0ZXIgaW5pdGlhbGl6YXRpb24gZmFpbGVkLCBmYWxsaW5nIGJhY2sgdG8gSldUIG9ubHlcIik7XG4gICAgICByZXR1cm4ge307IC8vIE5vIGFkYXB0ZXIgaWYgTW9uZ29EQiBpcyB1bmF2YWlsYWJsZVxuICAgIH1cbiAgfSkoKSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiBcIkNyZWRlbnRpYWxzXCIsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICBlbWFpbDogeyBsYWJlbDogXCJFbWFpbFwiLCB0eXBlOiBcInRleHRcIiB9LFxuICAgICAgICBwYXNzd29yZDogeyBsYWJlbDogXCJQYXNzd29yZFwiLCB0eXBlOiBcInBhc3N3b3JkXCIgfSxcbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIGNyZWRlbnRpYWxzIHByb3ZpZGVkJyk7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gY3JlZGVudGlhbHM7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ01pc3NpbmcgZW1haWwgb3IgcGFzc3dvcmQnKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgQXR0ZW1wdGluZyB0byBhdXRob3JpemU6ICR7ZW1haWx9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVHJ5IHRvIGNyZWF0ZSB0ZXN0IHVzZXIgaWYgdGhleSBkb24ndCBleGlzdFxuICAgICAgICAgIGlmIChlbWFpbCA9PT0gJ3Rlc3RAZXhhbXBsZS5jb20nICYmIHBhc3N3b3JkID09PSAncGFzc3dvcmQxMjMnKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBnZXRVc2VyQnlFbWFpbChlbWFpbCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nVXNlcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGluZyB0ZXN0IHVzZXIgc2luY2UgaXQgZG9lcyBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXN0VXNlciA9IGF3YWl0IGNyZWF0ZVVzZXIoe1xuICAgICAgICAgICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLCBcbiAgICAgICAgICAgICAgICAgIG5hbWU6ICdUZXN0IFVzZXInLFxuICAgICAgICAgICAgICAgICAgdHJpYWxfc3RhcnRfZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaXNfc3Vic2NyaWJlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVGVzdCB1c2VyIGNyZWF0ZWQgd2l0aCBJRDogJHt0ZXN0VXNlci5pZH1gKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIG5ld2x5IGNyZWF0ZWQgdGVzdCB1c2VyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgIGlkOiB0ZXN0VXNlci5pZCxcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiB0ZXN0VXNlci5lbWFpbCxcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHRlc3RVc2VyLm5hbWUsXG4gICAgICAgICAgICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLmlkXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZy9jcmVhdGluZyB0ZXN0IHVzZXI6JywgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZldGNoIHRoZSB1c2VyIGZyb20gTW9uZ29EQi9mYWxsYmFjayBzdG9yYWdlXG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGdldFVzZXJCeUVtYWlsKGVtYWlsKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBObyB1c2VyIGZvdW5kIHdpdGggZW1haWw6ICR7ZW1haWx9YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYFVzZXIgZm91bmQ6ICR7dXNlci5lbWFpbH0sIElEOiAke3VzZXIuX2lkfSwgdmVyaWZ5aW5nIHBhc3N3b3JkYCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVmVyaWZ5IHRoZSBwYXNzd29yZFxuICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2ZXJpZnlQYXNzd29yZChwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSW52YWxpZCBwYXNzd29yZCcpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKCdQYXNzd29yZCB2ZXJpZmllZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDb252ZXJ0IElEIHRvIHN0cmluZyBpZiBpdCdzIGFuIG9iamVjdFxuICAgICAgICAgIGNvbnN0IHVzZXJJZCA9IHR5cGVvZiB1c2VyLl9pZCA9PT0gJ29iamVjdCcgPyB1c2VyLl9pZC50b1N0cmluZygpIDogdXNlci5faWQ7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gUmV0dXJuIGEgdXNlciBvYmplY3QgZXhjbHVkaW5nIHRoZSBwYXNzd29yZFxuICAgICAgICAgIHJldHVybiB7IFxuICAgICAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lIHx8ICcnLFxuICAgICAgICAgICAgdXNlcklkOiB1c2VySWRcbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGF1dGhvcml6ZTonLCBlcnJvcik7XG4gICAgICAgICAgLy8gRG9uJ3QgdGhyb3csIHJldHVybiBudWxsIGluc3RlYWQgdG8gc2hvdyB0aGUgZXJyb3Igb24gdGhlIGxvZ2luIGZvcm1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KSxcbiAgXSxcbiAgc2Vzc2lvbjoge1xuICAgIHN0cmF0ZWd5OiBcImp3dFwiLFxuICB9LFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5pZCA9IHVzZXIuaWQ7XG4gICAgICAgIHRva2VuLnVzZXJJZCA9IHVzZXIuaWQ7IC8vIEVuc3VyZSB1c2VySWQgaXMgaW4gdGhlIHRva2VuXG4gICAgICAgIHRva2VuLm5hbWUgPSB1c2VyLm5hbWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW47XG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xuICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgIHNlc3Npb24udXNlci5pZCA9IHRva2VuLmlkO1xuICAgICAgICBzZXNzaW9uLnVzZXIudXNlcklkID0gdG9rZW4uaWQ7IC8vIEFkZCB1c2VySWQgdG8gc2Vzc2lvbiBmb3IgY29uc2lzdGVuY3lcbiAgICAgICAgaWYgKHRva2VuLm5hbWUpIHtcbiAgICAgICAgICBzZXNzaW9uLnVzZXIubmFtZSA9IHRva2VuLm5hbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXNzaW9uO1xuICAgIH0sXG4gIH0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiBcIi9sb2dpblwiLFxuICAgIGVycm9yOiBcIi9sb2dpblwiLCAvLyBFcnJvciBjb2RlIHBhc3NlZCBpbiBxdWVyeSBzdHJpbmcgYXMgP2Vycm9yPVxuICAgIG5ld1VzZXI6IFwiL2Rhc2hib2FyZFwiLCAvLyBSZWRpcmVjdCBuZXcgdXNlcnMgdG8gZGFzaGJvYXJkXG4gIH0sXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVUIHx8IFwiYS1zdHJvbmctc2VjcmV0LWZvci1kZXZlbG9wbWVudC1vbmx5XCIsXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jyxcbn0pOyJdLCJuYW1lcyI6WyJOZXh0QXV0aCIsIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJNb25nb0RCQWRhcHRlciIsImNsaWVudFByb21pc2UiLCJnZXRVc2VyQnlFbWFpbCIsInZlcmlmeVBhc3N3b3JkIiwiY3JlYXRlVXNlciIsImFkYXB0ZXIiLCJlIiwiY29uc29sZSIsIndhcm4iLCJwcm92aWRlcnMiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwiZXJyb3IiLCJsb2ciLCJleGlzdGluZ1VzZXIiLCJ0ZXN0VXNlciIsInRyaWFsX3N0YXJ0X2RhdGUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJpc19zdWJzY3JpYmVkIiwiaWQiLCJ1c2VySWQiLCJ1c2VyIiwiX2lkIiwiaXNWYWxpZCIsInRvU3RyaW5nIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJwYWdlcyIsInNpZ25JbiIsIm5ld1VzZXIiLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVEFVVEhfU0VDUkVUIiwiZGVidWciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/auth/[...nextauth].js\n");

/***/ }),

/***/ "@next-auth/mongodb-adapter":
/*!*********************************************!*\
  !*** external "@next-auth/mongodb-adapter" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("@next-auth/mongodb-adapter");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = import("bcryptjs");;

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next-auth":
/*!****************************!*\
  !*** external "next-auth" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("next-auth");

/***/ }),

/***/ "next-auth/providers/credentials":
/*!**************************************************!*\
  !*** external "next-auth/providers/credentials" ***!
  \**************************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/credentials");

/***/ }),

/***/ "next-auth/react":
/*!**********************************!*\
  !*** external "next-auth/react" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("next-auth/react");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth%2F%5B...nextauth%5D&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth%2F%5B...nextauth%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();