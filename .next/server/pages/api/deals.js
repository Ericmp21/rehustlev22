"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/deals";
exports.ids = ["pages/api/deals"];
exports.modules = {

/***/ "(api-node)/./lib/mongodb.js":
/*!************************!*\
  !*** ./lib/mongodb.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n// Check if we're on the client side\nconst isClient = \"undefined\" !== 'undefined';\n// Only access MONGODB_URI on the server side\nconst MONGODB_URI = !isClient ? process.env.MONGODB_URI : null;\n// Skip validation on client-side\nif (!isClient && !MONGODB_URI) {\n    throw new Error(\"Please define the MONGODB_URI\");\n}\n// Parse username from URI for logging purposes only\ntry {\n    if (MONGODB_URI.includes('@')) {\n        const credentialPart = MONGODB_URI.split('@')[0].split('//')[1];\n        if (credentialPart && credentialPart.includes(':')) {\n            const username = credentialPart.split(':')[0];\n            console.log(`Using MongoDB with username: ${username}`);\n        }\n    }\n} catch (error) {\n// Ignore parsing errors\n}\nlet cached = global.mongoose;\nif (!cached) {\n    cached = global.mongoose = {\n        conn: null,\n        promise: null\n    };\n}\nasync function dbConnect() {\n    // If we're on the client side, return a dummy connection that won't crash\n    if (isClient) {\n        console.log(\"Client-side MongoDB access attempted - using mock\");\n        return createMockMongoose();\n    }\n    if (cached.conn) {\n        console.log(\"Using cached database connection\");\n        return cached.conn;\n    }\n    if (!cached.promise) {\n        const opts = {\n            bufferCommands: false,\n            // Use these options for more reliable connection\n            serverSelectionTimeoutMS: 5000,\n            connectTimeoutMS: 10000\n        };\n        console.log(\"Connecting to MongoDB...\");\n        cached.promise = mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(MONGODB_URI, opts).then((mongoose)=>{\n            console.log(\"MongoDB connected successfully\");\n            return mongoose;\n        }).catch((error)=>{\n            console.error(\"MongoDB connection error:\", error);\n            // Return a \"mock mongoose\" that won't crash but won't do anything\n            // This allows the app to continue running without a database\n            return createMockMongoose();\n        });\n    }\n    try {\n        cached.conn = await cached.promise;\n        return cached.conn;\n    } catch (e) {\n        console.error(\"Error resolving MongoDB connection:\", e);\n        throw e;\n    }\n}\n// Creates a mock Mongoose that won't crash but won't do anything\n// Used as a fallback when MongoDB connection fails\nfunction createMockMongoose() {\n    console.warn(\"Using mock Mongoose (no database persistence)\");\n    // In-memory storage for collections\n    const collections = {};\n    // Initialize with empty collections\n    const knownCollections = [\n        'users',\n        'deals',\n        'accounts',\n        'User',\n        'Deal'\n    ];\n    knownCollections.forEach((name)=>{\n        collections[name] = [];\n    });\n    // Try to load from localStorage or global memory\n    if (false) {} else if (typeof global !== 'undefined' && global._localDbStorage) {\n        knownCollections.forEach((name)=>{\n            try {\n                const data = global._localDbStorage[`rehustle_${name}`];\n                if (data) {\n                    collections[name] = JSON.parse(data);\n                    console.log(`Loaded ${collections[name].length} items from server memory for ${name}`);\n                }\n            } catch (e) {\n                console.error(`Error loading ${name} from server memory:`, e);\n            }\n        });\n    }\n    // Save data helper\n    const saveCollection = (name, data)=>{\n        if (false) {} else if (typeof global !== 'undefined') {\n            if (!global._localDbStorage) {\n                global._localDbStorage = {};\n            }\n            global._localDbStorage[`rehustle_${name}`] = JSON.stringify(data);\n        }\n    };\n    // Create mock models for each known collection type\n    const mockModels = {};\n    knownCollections.forEach((name)=>{\n        // Create a basic model implementation\n        mockModels[name] = {\n            findOne: async (query)=>{\n                console.log(`[MockDB] findOne in ${name}:`, query);\n                const found = collections[name].find((doc)=>Object.entries(query).every(([key, value])=>doc[key] === value));\n                return found ? {\n                    ...found\n                } : null;\n            },\n            findById: async (id)=>{\n                console.log(`[MockDB] findById in ${name}:`, id);\n                const found = collections[name].find((doc)=>doc._id === id);\n                return found ? {\n                    ...found\n                } : null;\n            },\n            find: async (query)=>{\n                console.log(`[MockDB] find in ${name}:`, query);\n                return collections[name].filter((doc)=>Object.entries(query).every(([key, value])=>doc[key] === value));\n            },\n            create: async (data)=>{\n                console.log(`[MockDB] create in ${name}:`, data);\n                const _id = `mock_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;\n                const newDoc = {\n                    ...data,\n                    _id\n                };\n                collections[name].push(newDoc);\n                saveCollection(name, collections[name]);\n                return {\n                    ...newDoc\n                };\n            },\n            findByIdAndUpdate: async (id, update, options)=>{\n                console.log(`[MockDB] findByIdAndUpdate in ${name}:`, id, update);\n                const index = collections[name].findIndex((doc)=>doc._id === id);\n                if (index === -1) {\n                    if (options?.upsert) {\n                        const newDoc = {\n                            ...update,\n                            _id: id\n                        };\n                        collections[name].push(newDoc);\n                        saveCollection(name, collections[name]);\n                        return newDoc;\n                    }\n                    return null;\n                }\n                // Apply updates\n                if (update.$set) {\n                    collections[name][index] = {\n                        ...collections[name][index],\n                        ...update.$set\n                    };\n                } else {\n                    // Direct update\n                    collections[name][index] = {\n                        ...collections[name][index],\n                        ...update\n                    };\n                }\n                saveCollection(name, collections[name]);\n                return {\n                    ...collections[name][index]\n                };\n            },\n            updateOne: async (filter, update)=>{\n                console.log(`[MockDB] updateOne in ${name}:`, filter, update);\n                const index = collections[name].findIndex((doc)=>Object.entries(filter).every(([key, value])=>doc[key] === value));\n                if (index !== -1) {\n                    if (update.$set) {\n                        collections[name][index] = {\n                            ...collections[name][index],\n                            ...update.$set\n                        };\n                    } else {\n                        collections[name][index] = {\n                            ...collections[name][index],\n                            ...update\n                        };\n                    }\n                    saveCollection(name, collections[name]);\n                    return {\n                        modifiedCount: 1,\n                        acknowledged: true\n                    };\n                }\n                return {\n                    modifiedCount: 0,\n                    acknowledged: true\n                };\n            },\n            deleteOne: async (filter)=>{\n                console.log(`[MockDB] deleteOne in ${name}:`, filter);\n                const initialLength = collections[name].length;\n                collections[name] = collections[name].filter((doc)=>!Object.entries(filter).every(([key, value])=>doc[key] === value));\n                if (initialLength !== collections[name].length) {\n                    saveCollection(name, collections[name]);\n                }\n                return {\n                    deletedCount: initialLength - collections[name].length,\n                    acknowledged: true\n                };\n            }\n        };\n    });\n    // Pre-initialize User model with test user data\n    if (collections['User'].length === 0) {\n        collections['User'].push({\n            _id: 'mock_test_user_id',\n            email: 'test@example.com',\n            password: 'password123',\n            name: 'Test User',\n            trial_start_date: new Date(),\n            is_subscribed: false,\n            createdAt: new Date()\n        });\n        saveCollection('User', collections['User']);\n    }\n    // Mock mongoose object with minimum required functionality\n    return {\n        // This is what we return from mongoose.connect()\n        connection: {\n            readyState: 1\n        },\n        models: mockModels,\n        model: (name, schema)=>{\n            // If model already exists, return it\n            if (mockModels[name]) {\n                return mockModels[name];\n            }\n            // Otherwise create a new one\n            if (!collections[name]) {\n                collections[name] = [];\n            }\n            // Create model and store in cache\n            mockModels[name] = {\n                findOne: async (query)=>{\n                    console.log(`[MockDB] findOne in ${name}:`, query);\n                    const found = collections[name].find((doc)=>Object.entries(query).every(([key, value])=>doc[key] === value));\n                    return found ? {\n                        ...found\n                    } : null;\n                },\n                findById: async (id)=>{\n                    console.log(`[MockDB] findById in ${name}:`, id);\n                    const found = collections[name].find((doc)=>doc._id === id);\n                    return found ? {\n                        ...found\n                    } : null;\n                },\n                find: async (query)=>{\n                    console.log(`[MockDB] find in ${name}:`, query);\n                    return collections[name].filter((doc)=>Object.entries(query).every(([key, value])=>doc[key] === value));\n                },\n                create: async (data)=>{\n                    console.log(`[MockDB] create in ${name}:`, data);\n                    const _id = `mock_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;\n                    const newDoc = {\n                        ...data,\n                        _id\n                    };\n                    collections[name].push(newDoc);\n                    saveCollection(name, collections[name]);\n                    return {\n                        ...newDoc\n                    };\n                },\n                findByIdAndUpdate: async (id, update, options)=>{\n                    console.log(`[MockDB] findByIdAndUpdate in ${name}:`, id, update);\n                    const index = collections[name].findIndex((doc)=>doc._id === id);\n                    if (index === -1) {\n                        if (options?.upsert) {\n                            const newDoc = {\n                                ...update,\n                                _id: id\n                            };\n                            collections[name].push(newDoc);\n                            saveCollection(name, collections[name]);\n                            return newDoc;\n                        }\n                        return null;\n                    }\n                    // Apply updates\n                    if (update.$set) {\n                        collections[name][index] = {\n                            ...collections[name][index],\n                            ...update.$set\n                        };\n                    } else {\n                        // Direct update\n                        collections[name][index] = {\n                            ...collections[name][index],\n                            ...update\n                        };\n                    }\n                    saveCollection(name, collections[name]);\n                    return {\n                        ...collections[name][index]\n                    };\n                },\n                updateOne: async (filter, update)=>{\n                    console.log(`[MockDB] updateOne in ${name}:`, filter, update);\n                    const index = collections[name].findIndex((doc)=>Object.entries(filter).every(([key, value])=>doc[key] === value));\n                    if (index !== -1) {\n                        if (update.$set) {\n                            collections[name][index] = {\n                                ...collections[name][index],\n                                ...update.$set\n                            };\n                        } else {\n                            collections[name][index] = {\n                                ...collections[name][index],\n                                ...update\n                            };\n                        }\n                        saveCollection(name, collections[name]);\n                        return {\n                            modifiedCount: 1,\n                            acknowledged: true\n                        };\n                    }\n                    return {\n                        modifiedCount: 0,\n                        acknowledged: true\n                    };\n                },\n                deleteOne: async (filter)=>{\n                    console.log(`[MockDB] deleteOne in ${name}:`, filter);\n                    const initialLength = collections[name].length;\n                    collections[name] = collections[name].filter((doc)=>!Object.entries(filter).every(([key, value])=>doc[key] === value));\n                    if (initialLength !== collections[name].length) {\n                        saveCollection(name, collections[name]);\n                    }\n                    return {\n                        deletedCount: initialLength - collections[name].length,\n                        acknowledged: true\n                    };\n                }\n            };\n            return mockModels[name];\n        }\n    };\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (dbConnect);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y0FBY0QsZ0JBQWdCbEQsV0FBVyxDQUFDRyxLQUFLLENBQUNPLE1BQU07d0JBQUVzQyxjQUFjO29CQUFLO2dCQUN0RjtZQUNGO1lBRUEsT0FBT2pDLFVBQVUsQ0FBQ1osS0FBSztRQUN6QjtJQUNGO0FBQ0Y7QUFFQSxpRUFBZWQsU0FBU0EsRUFBQyIsInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9saWIvbW9uZ29kYi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbi8vIENoZWNrIGlmIHdlJ3JlIG9uIHRoZSBjbGllbnQgc2lkZVxuY29uc3QgaXNDbGllbnQgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJztcblxuLy8gT25seSBhY2Nlc3MgTU9OR09EQl9VUkkgb24gdGhlIHNlcnZlciBzaWRlXG5jb25zdCBNT05HT0RCX1VSSSA9ICFpc0NsaWVudCA/IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJIDogbnVsbDtcblxuLy8gU2tpcCB2YWxpZGF0aW9uIG9uIGNsaWVudC1zaWRlXG5pZiAoIWlzQ2xpZW50ICYmICFNT05HT0RCX1VSSSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJQbGVhc2UgZGVmaW5lIHRoZSBNT05HT0RCX1VSSVwiKTtcbn1cblxuLy8gUGFyc2UgdXNlcm5hbWUgZnJvbSBVUkkgZm9yIGxvZ2dpbmcgcHVycG9zZXMgb25seVxudHJ5IHtcbiAgaWYgKE1PTkdPREJfVVJJLmluY2x1ZGVzKCdAJykpIHtcbiAgICBjb25zdCBjcmVkZW50aWFsUGFydCA9IE1PTkdPREJfVVJJLnNwbGl0KCdAJylbMF0uc3BsaXQoJy8vJylbMV07XG4gICAgaWYgKGNyZWRlbnRpYWxQYXJ0ICYmIGNyZWRlbnRpYWxQYXJ0LmluY2x1ZGVzKCc6JykpIHtcbiAgICAgIGNvbnN0IHVzZXJuYW1lID0gY3JlZGVudGlhbFBhcnQuc3BsaXQoJzonKVswXTtcbiAgICAgIGNvbnNvbGUubG9nKGBVc2luZyBNb25nb0RCIHdpdGggdXNlcm5hbWU6ICR7dXNlcm5hbWV9YCk7XG4gICAgfVxuICB9XG59IGNhdGNoIChlcnJvcikge1xuICAvLyBJZ25vcmUgcGFyc2luZyBlcnJvcnNcbn1cblxubGV0IGNhY2hlZCA9IGdsb2JhbC5tb25nb29zZTtcblxuaWYgKCFjYWNoZWQpIHtcbiAgY2FjaGVkID0gZ2xvYmFsLm1vbmdvb3NlID0geyBjb25uOiBudWxsLCBwcm9taXNlOiBudWxsIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRiQ29ubmVjdCgpIHtcbiAgLy8gSWYgd2UncmUgb24gdGhlIGNsaWVudCBzaWRlLCByZXR1cm4gYSBkdW1teSBjb25uZWN0aW9uIHRoYXQgd29uJ3QgY3Jhc2hcbiAgaWYgKGlzQ2xpZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJDbGllbnQtc2lkZSBNb25nb0RCIGFjY2VzcyBhdHRlbXB0ZWQgLSB1c2luZyBtb2NrXCIpO1xuICAgIHJldHVybiBjcmVhdGVNb2NrTW9uZ29vc2UoKTtcbiAgfVxuICBcbiAgaWYgKGNhY2hlZC5jb25uKSB7XG4gICAgY29uc29sZS5sb2coXCJVc2luZyBjYWNoZWQgZGF0YWJhc2UgY29ubmVjdGlvblwiKTtcbiAgICByZXR1cm4gY2FjaGVkLmNvbm47XG4gIH1cblxuICBpZiAoIWNhY2hlZC5wcm9taXNlKSB7XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIGJ1ZmZlckNvbW1hbmRzOiBmYWxzZSxcbiAgICAgIC8vIFVzZSB0aGVzZSBvcHRpb25zIGZvciBtb3JlIHJlbGlhYmxlIGNvbm5lY3Rpb25cbiAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogNTAwMCxcbiAgICAgIGNvbm5lY3RUaW1lb3V0TVM6IDEwMDAwLFxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZyhcIkNvbm5lY3RpbmcgdG8gTW9uZ29EQi4uLlwiKTtcbiAgICBjYWNoZWQucHJvbWlzZSA9IG1vbmdvb3NlLmNvbm5lY3QoTU9OR09EQl9VUkksIG9wdHMpXG4gICAgICAudGhlbigobW9uZ29vc2UpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJNb25nb0RCIGNvbm5lY3RlZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICAgIHJldHVybiBtb25nb29zZTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJNb25nb0RCIGNvbm5lY3Rpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgLy8gUmV0dXJuIGEgXCJtb2NrIG1vbmdvb3NlXCIgdGhhdCB3b24ndCBjcmFzaCBidXQgd29uJ3QgZG8gYW55dGhpbmdcbiAgICAgICAgLy8gVGhpcyBhbGxvd3MgdGhlIGFwcCB0byBjb250aW51ZSBydW5uaW5nIHdpdGhvdXQgYSBkYXRhYmFzZVxuICAgICAgICByZXR1cm4gY3JlYXRlTW9ja01vbmdvb3NlKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY2FjaGVkLmNvbm4gPSBhd2FpdCBjYWNoZWQucHJvbWlzZTtcbiAgICByZXR1cm4gY2FjaGVkLmNvbm47XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVzb2x2aW5nIE1vbmdvREIgY29ubmVjdGlvbjpcIiwgZSk7XG4gICAgdGhyb3cgZTtcbiAgfVxufVxuXG4vLyBDcmVhdGVzIGEgbW9jayBNb25nb29zZSB0aGF0IHdvbid0IGNyYXNoIGJ1dCB3b24ndCBkbyBhbnl0aGluZ1xuLy8gVXNlZCBhcyBhIGZhbGxiYWNrIHdoZW4gTW9uZ29EQiBjb25uZWN0aW9uIGZhaWxzXG5mdW5jdGlvbiBjcmVhdGVNb2NrTW9uZ29vc2UoKSB7XG4gIGNvbnNvbGUud2FybihcIlVzaW5nIG1vY2sgTW9uZ29vc2UgKG5vIGRhdGFiYXNlIHBlcnNpc3RlbmNlKVwiKTtcbiAgXG4gIC8vIEluLW1lbW9yeSBzdG9yYWdlIGZvciBjb2xsZWN0aW9uc1xuICBjb25zdCBjb2xsZWN0aW9ucyA9IHt9O1xuICBcbiAgLy8gSW5pdGlhbGl6ZSB3aXRoIGVtcHR5IGNvbGxlY3Rpb25zXG4gIGNvbnN0IGtub3duQ29sbGVjdGlvbnMgPSBbJ3VzZXJzJywgJ2RlYWxzJywgJ2FjY291bnRzJywgJ1VzZXInLCAnRGVhbCddO1xuICBrbm93bkNvbGxlY3Rpb25zLmZvckVhY2gobmFtZSA9PiB7XG4gICAgY29sbGVjdGlvbnNbbmFtZV0gPSBbXTtcbiAgfSk7XG4gIFxuICAvLyBUcnkgdG8gbG9hZCBmcm9tIGxvY2FsU3RvcmFnZSBvciBnbG9iYWwgbWVtb3J5XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKSB7XG4gICAga25vd25Db2xsZWN0aW9ucy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGByZWh1c3RsZV8ke25hbWV9YCk7XG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgY29sbGVjdGlvbnNbbmFtZV0gPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBMb2FkZWQgJHtjb2xsZWN0aW9uc1tuYW1lXS5sZW5ndGh9IGl0ZW1zIGZyb20gbG9jYWxTdG9yYWdlIGZvciAke25hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgbG9hZGluZyAke25hbWV9IGZyb20gbG9jYWxTdG9yYWdlOmAsIGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbC5fbG9jYWxEYlN0b3JhZ2UpIHtcbiAgICBrbm93bkNvbGxlY3Rpb25zLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkYXRhID0gZ2xvYmFsLl9sb2NhbERiU3RvcmFnZVtgcmVodXN0bGVfJHtuYW1lfWBdO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgIGNvbGxlY3Rpb25zW25hbWVdID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgTG9hZGVkICR7Y29sbGVjdGlvbnNbbmFtZV0ubGVuZ3RofSBpdGVtcyBmcm9tIHNlcnZlciBtZW1vcnkgZm9yICR7bmFtZX1gKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBsb2FkaW5nICR7bmFtZX0gZnJvbSBzZXJ2ZXIgbWVtb3J5OmAsIGUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIFxuICAvLyBTYXZlIGRhdGEgaGVscGVyXG4gIGNvbnN0IHNhdmVDb2xsZWN0aW9uID0gKG5hbWUsIGRhdGEpID0+IHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHJlaHVzdGxlXyR7bmFtZX1gLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgaWYgKCFnbG9iYWwuX2xvY2FsRGJTdG9yYWdlKSB7XG4gICAgICAgIGdsb2JhbC5fbG9jYWxEYlN0b3JhZ2UgPSB7fTtcbiAgICAgIH1cbiAgICAgIGdsb2JhbC5fbG9jYWxEYlN0b3JhZ2VbYHJlaHVzdGxlXyR7bmFtZX1gXSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgIH1cbiAgfTtcbiAgXG4gIC8vIENyZWF0ZSBtb2NrIG1vZGVscyBmb3IgZWFjaCBrbm93biBjb2xsZWN0aW9uIHR5cGVcbiAgY29uc3QgbW9ja01vZGVscyA9IHt9O1xuICBrbm93bkNvbGxlY3Rpb25zLmZvckVhY2gobmFtZSA9PiB7XG4gICAgLy8gQ3JlYXRlIGEgYmFzaWMgbW9kZWwgaW1wbGVtZW50YXRpb25cbiAgICBtb2NrTW9kZWxzW25hbWVdID0ge1xuICAgICAgZmluZE9uZTogYXN5bmMgKHF1ZXJ5KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSBmaW5kT25lIGluICR7bmFtZX06YCwgcXVlcnkpO1xuICAgICAgICBjb25zdCBmb3VuZCA9IGNvbGxlY3Rpb25zW25hbWVdLmZpbmQoZG9jID0+IFxuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHF1ZXJ5KS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiBkb2Nba2V5XSA9PT0gdmFsdWUpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBmb3VuZCA/IHsuLi5mb3VuZH0gOiBudWxsO1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgZmluZEJ5SWQ6IGFzeW5jIChpZCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gZmluZEJ5SWQgaW4gJHtuYW1lfTpgLCBpZCk7XG4gICAgICAgIGNvbnN0IGZvdW5kID0gY29sbGVjdGlvbnNbbmFtZV0uZmluZChkb2MgPT4gZG9jLl9pZCA9PT0gaWQpO1xuICAgICAgICByZXR1cm4gZm91bmQgPyB7Li4uZm91bmR9IDogbnVsbDtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIGZpbmQ6IGFzeW5jIChxdWVyeSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gZmluZCBpbiAke25hbWV9OmAsIHF1ZXJ5KTtcbiAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb25zW25hbWVdLmZpbHRlcihkb2MgPT5cbiAgICAgICAgICBPYmplY3QuZW50cmllcyhxdWVyeSkuZXZlcnkoKFtrZXksIHZhbHVlXSkgPT4gZG9jW2tleV0gPT09IHZhbHVlKVxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgY3JlYXRlOiBhc3luYyAoZGF0YSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gY3JlYXRlIGluICR7bmFtZX06YCwgZGF0YSk7XG4gICAgICAgIGNvbnN0IF9pZCA9IGBtb2NrXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOCl9YDtcbiAgICAgICAgY29uc3QgbmV3RG9jID0geyAuLi5kYXRhLCBfaWQgfTtcbiAgICAgICAgY29sbGVjdGlvbnNbbmFtZV0ucHVzaChuZXdEb2MpO1xuICAgICAgICBzYXZlQ29sbGVjdGlvbihuYW1lLCBjb2xsZWN0aW9uc1tuYW1lXSk7XG4gICAgICAgIHJldHVybiB7IC4uLm5ld0RvYyB9O1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgZmluZEJ5SWRBbmRVcGRhdGU6IGFzeW5jIChpZCwgdXBkYXRlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSBmaW5kQnlJZEFuZFVwZGF0ZSBpbiAke25hbWV9OmAsIGlkLCB1cGRhdGUpO1xuICAgICAgICBjb25zdCBpbmRleCA9IGNvbGxlY3Rpb25zW25hbWVdLmZpbmRJbmRleChkb2MgPT4gZG9jLl9pZCA9PT0gaWQpO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnM/LnVwc2VydCkge1xuICAgICAgICAgICAgY29uc3QgbmV3RG9jID0geyAuLi51cGRhdGUsIF9pZDogaWQgfTtcbiAgICAgICAgICAgIGNvbGxlY3Rpb25zW25hbWVdLnB1c2gobmV3RG9jKTtcbiAgICAgICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgICAgIHJldHVybiBuZXdEb2M7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBcHBseSB1cGRhdGVzXG4gICAgICAgIGlmICh1cGRhdGUuJHNldCkge1xuICAgICAgICAgIGNvbGxlY3Rpb25zW25hbWVdW2luZGV4XSA9IHsgLi4uY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdLCAuLi51cGRhdGUuJHNldCB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIERpcmVjdCB1cGRhdGVcbiAgICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0gPSB7IC4uLmNvbGxlY3Rpb25zW25hbWVdW2luZGV4XSwgLi4udXBkYXRlIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgcmV0dXJuIHsgLi4uY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdIH07XG4gICAgICB9LFxuICAgICAgXG4gICAgICB1cGRhdGVPbmU6IGFzeW5jIChmaWx0ZXIsIHVwZGF0ZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gdXBkYXRlT25lIGluICR7bmFtZX06YCwgZmlsdGVyLCB1cGRhdGUpO1xuICAgICAgICBjb25zdCBpbmRleCA9IGNvbGxlY3Rpb25zW25hbWVdLmZpbmRJbmRleChkb2MgPT4gXG4gICAgICAgICAgT2JqZWN0LmVudHJpZXMoZmlsdGVyKS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiBkb2Nba2V5XSA9PT0gdmFsdWUpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgaWYgKHVwZGF0ZS4kc2V0KSB7XG4gICAgICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0gPSB7IC4uLmNvbGxlY3Rpb25zW25hbWVdW2luZGV4XSwgLi4udXBkYXRlLiRzZXQgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdID0geyAuLi5jb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0sIC4uLnVwZGF0ZSB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBzYXZlQ29sbGVjdGlvbihuYW1lLCBjb2xsZWN0aW9uc1tuYW1lXSk7XG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWRDb3VudDogMSwgYWNrbm93bGVkZ2VkOiB0cnVlIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IG1vZGlmaWVkQ291bnQ6IDAsIGFja25vd2xlZGdlZDogdHJ1ZSB9O1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgZGVsZXRlT25lOiBhc3luYyAoZmlsdGVyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSBkZWxldGVPbmUgaW4gJHtuYW1lfTpgLCBmaWx0ZXIpO1xuICAgICAgICBjb25zdCBpbml0aWFsTGVuZ3RoID0gY29sbGVjdGlvbnNbbmFtZV0ubGVuZ3RoO1xuICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXSA9IGNvbGxlY3Rpb25zW25hbWVdLmZpbHRlcihkb2MgPT4gXG4gICAgICAgICAgIU9iamVjdC5lbnRyaWVzKGZpbHRlcikuZXZlcnkoKFtrZXksIHZhbHVlXSkgPT4gZG9jW2tleV0gPT09IHZhbHVlKVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKGluaXRpYWxMZW5ndGggIT09IGNvbGxlY3Rpb25zW25hbWVdLmxlbmd0aCkge1xuICAgICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHsgZGVsZXRlZENvdW50OiBpbml0aWFsTGVuZ3RoIC0gY29sbGVjdGlvbnNbbmFtZV0ubGVuZ3RoLCBhY2tub3dsZWRnZWQ6IHRydWUgfTtcbiAgICAgIH1cbiAgICB9O1xuICB9KTtcbiAgXG4gIC8vIFByZS1pbml0aWFsaXplIFVzZXIgbW9kZWwgd2l0aCB0ZXN0IHVzZXIgZGF0YVxuICBpZiAoY29sbGVjdGlvbnNbJ1VzZXInXS5sZW5ndGggPT09IDApIHtcbiAgICBjb2xsZWN0aW9uc1snVXNlciddLnB1c2goe1xuICAgICAgX2lkOiAnbW9ja190ZXN0X3VzZXJfaWQnLFxuICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gICAgICB0cmlhbF9zdGFydF9kYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgaXNfc3Vic2NyaWJlZDogZmFsc2UsXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgICBzYXZlQ29sbGVjdGlvbignVXNlcicsIGNvbGxlY3Rpb25zWydVc2VyJ10pO1xuICB9XG4gIFxuICAvLyBNb2NrIG1vbmdvb3NlIG9iamVjdCB3aXRoIG1pbmltdW0gcmVxdWlyZWQgZnVuY3Rpb25hbGl0eVxuICByZXR1cm4ge1xuICAgIC8vIFRoaXMgaXMgd2hhdCB3ZSByZXR1cm4gZnJvbSBtb25nb29zZS5jb25uZWN0KClcbiAgICBjb25uZWN0aW9uOiB7XG4gICAgICByZWFkeVN0YXRlOiAxLCAvLyBDb25uZWN0ZWRcbiAgICB9LFxuICAgIG1vZGVsczogbW9ja01vZGVscyxcbiAgICBtb2RlbDogKG5hbWUsIHNjaGVtYSkgPT4ge1xuICAgICAgLy8gSWYgbW9kZWwgYWxyZWFkeSBleGlzdHMsIHJldHVybiBpdFxuICAgICAgaWYgKG1vY2tNb2RlbHNbbmFtZV0pIHtcbiAgICAgICAgcmV0dXJuIG1vY2tNb2RlbHNbbmFtZV07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE90aGVyd2lzZSBjcmVhdGUgYSBuZXcgb25lXG4gICAgICBpZiAoIWNvbGxlY3Rpb25zW25hbWVdKSB7XG4gICAgICAgIGNvbGxlY3Rpb25zW25hbWVdID0gW107XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBtb2RlbCBhbmQgc3RvcmUgaW4gY2FjaGVcbiAgICAgIG1vY2tNb2RlbHNbbmFtZV0gPSB7XG4gICAgICAgIGZpbmRPbmU6IGFzeW5jIChxdWVyeSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSBmaW5kT25lIGluICR7bmFtZX06YCwgcXVlcnkpO1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gY29sbGVjdGlvbnNbbmFtZV0uZmluZChkb2MgPT4gXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhxdWVyeSkuZXZlcnkoKFtrZXksIHZhbHVlXSkgPT4gZG9jW2tleV0gPT09IHZhbHVlKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGZvdW5kID8gey4uLmZvdW5kfSA6IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBmaW5kQnlJZDogYXN5bmMgKGlkKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtNb2NrREJdIGZpbmRCeUlkIGluICR7bmFtZX06YCwgaWQpO1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gY29sbGVjdGlvbnNbbmFtZV0uZmluZChkb2MgPT4gZG9jLl9pZCA9PT0gaWQpO1xuICAgICAgICAgIHJldHVybiBmb3VuZCA/IHsuLi5mb3VuZH0gOiBudWxsO1xuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgZmluZDogYXN5bmMgKHF1ZXJ5KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtNb2NrREJdIGZpbmQgaW4gJHtuYW1lfTpgLCBxdWVyeSk7XG4gICAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb25zW25hbWVdLmZpbHRlcihkb2MgPT5cbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHF1ZXJ5KS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiBkb2Nba2V5XSA9PT0gdmFsdWUpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGNyZWF0ZTogYXN5bmMgKGRhdGEpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gY3JlYXRlIGluICR7bmFtZX06YCwgZGF0YSk7XG4gICAgICAgICAgY29uc3QgX2lkID0gYG1vY2tfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KX1gO1xuICAgICAgICAgIGNvbnN0IG5ld0RvYyA9IHsgLi4uZGF0YSwgX2lkIH07XG4gICAgICAgICAgY29sbGVjdGlvbnNbbmFtZV0ucHVzaChuZXdEb2MpO1xuICAgICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgICByZXR1cm4geyAuLi5uZXdEb2MgfTtcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGZpbmRCeUlkQW5kVXBkYXRlOiBhc3luYyAoaWQsIHVwZGF0ZSwgb3B0aW9ucykgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSBmaW5kQnlJZEFuZFVwZGF0ZSBpbiAke25hbWV9OmAsIGlkLCB1cGRhdGUpO1xuICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29sbGVjdGlvbnNbbmFtZV0uZmluZEluZGV4KGRvYyA9PiBkb2MuX2lkID09PSBpZCk7XG4gICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnM/LnVwc2VydCkge1xuICAgICAgICAgICAgICBjb25zdCBuZXdEb2MgPSB7IC4uLnVwZGF0ZSwgX2lkOiBpZCB9O1xuICAgICAgICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXS5wdXNoKG5ld0RvYyk7XG4gICAgICAgICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5ld0RvYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBcHBseSB1cGRhdGVzXG4gICAgICAgICAgaWYgKHVwZGF0ZS4kc2V0KSB7XG4gICAgICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0gPSB7IC4uLmNvbGxlY3Rpb25zW25hbWVdW2luZGV4XSwgLi4udXBkYXRlLiRzZXQgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRGlyZWN0IHVwZGF0ZVxuICAgICAgICAgICAgY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdID0geyAuLi5jb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0sIC4uLnVwZGF0ZSB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBzYXZlQ29sbGVjdGlvbihuYW1lLCBjb2xsZWN0aW9uc1tuYW1lXSk7XG4gICAgICAgICAgcmV0dXJuIHsgLi4uY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdIH07XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICB1cGRhdGVPbmU6IGFzeW5jIChmaWx0ZXIsIHVwZGF0ZSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBbTW9ja0RCXSB1cGRhdGVPbmUgaW4gJHtuYW1lfTpgLCBmaWx0ZXIsIHVwZGF0ZSk7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBjb2xsZWN0aW9uc1tuYW1lXS5maW5kSW5kZXgoZG9jID0+IFxuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZmlsdGVyKS5ldmVyeSgoW2tleSwgdmFsdWVdKSA9PiBkb2Nba2V5XSA9PT0gdmFsdWUpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBpZiAodXBkYXRlLiRzZXQpIHtcbiAgICAgICAgICAgICAgY29sbGVjdGlvbnNbbmFtZV1baW5kZXhdID0geyAuLi5jb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0sIC4uLnVwZGF0ZS4kc2V0IH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb2xsZWN0aW9uc1tuYW1lXVtpbmRleF0gPSB7IC4uLmNvbGxlY3Rpb25zW25hbWVdW2luZGV4XSwgLi4udXBkYXRlIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzYXZlQ29sbGVjdGlvbihuYW1lLCBjb2xsZWN0aW9uc1tuYW1lXSk7XG4gICAgICAgICAgICByZXR1cm4geyBtb2RpZmllZENvdW50OiAxLCBhY2tub3dsZWRnZWQ6IHRydWUgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHsgbW9kaWZpZWRDb3VudDogMCwgYWNrbm93bGVkZ2VkOiB0cnVlIH07XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBkZWxldGVPbmU6IGFzeW5jIChmaWx0ZXIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgW01vY2tEQl0gZGVsZXRlT25lIGluICR7bmFtZX06YCwgZmlsdGVyKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsTGVuZ3RoID0gY29sbGVjdGlvbnNbbmFtZV0ubGVuZ3RoO1xuICAgICAgICAgIGNvbGxlY3Rpb25zW25hbWVdID0gY29sbGVjdGlvbnNbbmFtZV0uZmlsdGVyKGRvYyA9PiBcbiAgICAgICAgICAgICFPYmplY3QuZW50cmllcyhmaWx0ZXIpLmV2ZXJ5KChba2V5LCB2YWx1ZV0pID0+IGRvY1trZXldID09PSB2YWx1ZSlcbiAgICAgICAgICApO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChpbml0aWFsTGVuZ3RoICE9PSBjb2xsZWN0aW9uc1tuYW1lXS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHNhdmVDb2xsZWN0aW9uKG5hbWUsIGNvbGxlY3Rpb25zW25hbWVdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHsgZGVsZXRlZENvdW50OiBpbml0aWFsTGVuZ3RoIC0gY29sbGVjdGlvbnNbbmFtZV0ubGVuZ3RoLCBhY2tub3dsZWRnZWQ6IHRydWUgfTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmV0dXJuIG1vY2tNb2RlbHNbbmFtZV07XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBkYkNvbm5lY3Q7Il0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiaXNDbGllbnQiLCJNT05HT0RCX1VSSSIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsImluY2x1ZGVzIiwiY3JlZGVudGlhbFBhcnQiLCJzcGxpdCIsInVzZXJuYW1lIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiY2FjaGVkIiwiZ2xvYmFsIiwiY29ubiIsInByb21pc2UiLCJkYkNvbm5lY3QiLCJjcmVhdGVNb2NrTW9uZ29vc2UiLCJvcHRzIiwiYnVmZmVyQ29tbWFuZHMiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJjb25uZWN0VGltZW91dE1TIiwiY29ubmVjdCIsInRoZW4iLCJjYXRjaCIsImUiLCJ3YXJuIiwiY29sbGVjdGlvbnMiLCJrbm93bkNvbGxlY3Rpb25zIiwiZm9yRWFjaCIsIm5hbWUiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJkYXRhIiwiZ2V0SXRlbSIsIkpTT04iLCJwYXJzZSIsImxlbmd0aCIsIl9sb2NhbERiU3RvcmFnZSIsInNhdmVDb2xsZWN0aW9uIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsIm1vY2tNb2RlbHMiLCJmaW5kT25lIiwicXVlcnkiLCJmb3VuZCIsImZpbmQiLCJkb2MiLCJPYmplY3QiLCJlbnRyaWVzIiwiZXZlcnkiLCJrZXkiLCJ2YWx1ZSIsImZpbmRCeUlkIiwiaWQiLCJfaWQiLCJmaWx0ZXIiLCJjcmVhdGUiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwibmV3RG9jIiwicHVzaCIsImZpbmRCeUlkQW5kVXBkYXRlIiwidXBkYXRlIiwib3B0aW9ucyIsImluZGV4IiwiZmluZEluZGV4IiwidXBzZXJ0IiwiJHNldCIsInVwZGF0ZU9uZSIsIm1vZGlmaWVkQ291bnQiLCJhY2tub3dsZWRnZWQiLCJkZWxldGVPbmUiLCJpbml0aWFsTGVuZ3RoIiwiZGVsZXRlZENvdW50IiwiZW1haWwiLCJwYXNzd29yZCIsInRyaWFsX3N0YXJ0X2RhdGUiLCJpc19zdWJzY3JpYmVkIiwiY3JlYXRlZEF0IiwiY29ubmVjdGlvbiIsInJlYWR5U3RhdGUiLCJtb2RlbHMiLCJtb2RlbCIsInNjaGVtYSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.js\n");

/***/ }),

/***/ "(api-node)/./models/Deal.js":
/*!************************!*\
  !*** ./models/Deal.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconst DealSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    userId: {\n        type: (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema).Types.ObjectId,\n        required: true\n    },\n    property_type: String,\n    sniper_score: Number,\n    risk_level: String,\n    recommended_offer: Number,\n    notes: String,\n    createdAt: {\n        type: Date,\n        default: Date.now\n    }\n}, {\n    timestamps: true\n});\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).Deal || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"Deal\", DealSchema));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL21vZGVscy9EZWFsLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFnQztBQUVoQyxNQUFNQyxhQUFhLElBQUlELHdEQUFlLENBQUM7SUFDckNHLFFBQVE7UUFBRUMsTUFBTUosd0RBQWUsQ0FBQ0ssS0FBSyxDQUFDQyxRQUFRO1FBQUVDLFVBQVU7SUFBSztJQUMvREMsZUFBZUM7SUFDZkMsY0FBY0M7SUFDZEMsWUFBWUg7SUFDWkksbUJBQW1CRjtJQUNuQkcsT0FBT0w7SUFDUE0sV0FBVztRQUFFWCxNQUFNWTtRQUFNQyxTQUFTRCxLQUFLRSxHQUFHO0lBQUM7QUFDN0MsR0FBRztJQUFFQyxZQUFZO0FBQUs7QUFFdEIsaUVBQWVuQix3REFBZSxDQUFDcUIsSUFBSSxJQUFJckIscURBQWMsQ0FBQyxRQUFRQyxXQUFXQSxFQUFDIiwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL21vZGVscy9EZWFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tIFwibW9uZ29vc2VcIjtcblxuY29uc3QgRGVhbFNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICB1c2VySWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZXF1aXJlZDogdHJ1ZSB9LFxuICBwcm9wZXJ0eV90eXBlOiBTdHJpbmcsXG4gIHNuaXBlcl9zY29yZTogTnVtYmVyLFxuICByaXNrX2xldmVsOiBTdHJpbmcsXG4gIHJlY29tbWVuZGVkX29mZmVyOiBOdW1iZXIsXG4gIG5vdGVzOiBTdHJpbmcsXG4gIGNyZWF0ZWRBdDogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxufSwgeyB0aW1lc3RhbXBzOiB0cnVlIH0pO1xuXG5leHBvcnQgZGVmYXVsdCBtb25nb29zZS5tb2RlbHMuRGVhbCB8fCBtb25nb29zZS5tb2RlbChcIkRlYWxcIiwgRGVhbFNjaGVtYSk7Il0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiRGVhbFNjaGVtYSIsIlNjaGVtYSIsInVzZXJJZCIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVxdWlyZWQiLCJwcm9wZXJ0eV90eXBlIiwiU3RyaW5nIiwic25pcGVyX3Njb3JlIiwiTnVtYmVyIiwicmlza19sZXZlbCIsInJlY29tbWVuZGVkX29mZmVyIiwibm90ZXMiLCJjcmVhdGVkQXQiLCJEYXRlIiwiZGVmYXVsdCIsIm5vdyIsInRpbWVzdGFtcHMiLCJtb2RlbHMiLCJEZWFsIiwibW9kZWwiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./models/Deal.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdeals%2Findex.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdeals%2Findex.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_deals_index_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/deals/index.js */ \"(api-node)/./pages/api/deals/index.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_deals_index_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_deals_index_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/deals\",\n        pathname: \"/api/deals\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_deals_index_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGZGVhbHMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmRlYWxzJTJGaW5kZXguanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDdUQ7QUFDdkQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9kZWFscy9pbmRleC5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZGVhbHNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kZWFsc1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdeals%2Findex.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/deals/index.js":
/*!**********************************!*\
  !*** ./pages/api/deals/index.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/react */ \"next-auth/react\");\n/* harmony import */ var next_auth_react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var _models_Deal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../models/Deal */ \"(api-node)/./models/Deal.js\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nasync function handler(req, res) {\n    const session = await (0,next_auth_react__WEBPACK_IMPORTED_MODULE_0__.getSession)({\n        req\n    });\n    // Check if user is authenticated\n    if (!session) {\n        return res.status(401).json({\n            error: 'You must be signed in to access this endpoint'\n        });\n    }\n    // Extract user ID from session\n    const userId = session.user.id;\n    // Connect to the database\n    try {\n        await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__[\"default\"])();\n    } catch (error) {\n        console.error('Database connection error:', error);\n        return res.status(500).json({\n            error: 'Database connection failed'\n        });\n    }\n    // Handle different HTTP methods\n    switch(req.method){\n        case 'GET':\n            return handleGet(req, res, userId);\n        case 'POST':\n            return handlePost(req, res, userId);\n        default:\n            return res.status(405).json({\n                error: 'Method not allowed'\n            });\n    }\n}\n// GET handler - Get all deals for a user\nasync function handleGet(req, res, userId) {\n    try {\n        // Convert string ID to MongoDB ObjectId\n        const objectId = mongoose__WEBPACK_IMPORTED_MODULE_3___default().Types.ObjectId.isValid(userId) ? new (mongoose__WEBPACK_IMPORTED_MODULE_3___default().Types).ObjectId(userId) : userId; // Fall back to string ID if not valid ObjectId\n        // Query all deals for the user\n        const deals = await _models_Deal__WEBPACK_IMPORTED_MODULE_2__[\"default\"].find({\n            userId: objectId\n        }).sort({\n            createdAt: -1\n        }) // Latest first\n        .lean(); // Convert to plain JavaScript objects\n        return res.status(200).json(deals);\n    } catch (error) {\n        console.error('Error fetching deals:', error);\n        return res.status(500).json({\n            error: 'Failed to fetch deals'\n        });\n    }\n}\n// POST handler - Create a new deal\nasync function handlePost(req, res, userId) {\n    try {\n        // Validate request body\n        const dealData = req.body;\n        if (!dealData || typeof dealData !== 'object') {\n            return res.status(400).json({\n                error: 'Invalid deal data'\n            });\n        }\n        // Convert string ID to MongoDB ObjectId\n        const objectId = mongoose__WEBPACK_IMPORTED_MODULE_3___default().Types.ObjectId.isValid(userId) ? new (mongoose__WEBPACK_IMPORTED_MODULE_3___default().Types).ObjectId(userId) : userId; // Fall back to string ID if not valid ObjectId\n        // Create a new deal\n        const deal = new _models_Deal__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n            ...dealData,\n            userId: objectId\n        });\n        // Save the deal\n        const savedDeal = await deal.save();\n        // Return the saved deal\n        return res.status(201).json(savedDeal);\n    } catch (error) {\n        console.error('Error creating deal:', error);\n        return res.status(500).json({\n            error: 'Failed to create deal'\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBd0I7SUFDL0Q7QUFDRiIsInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9wYWdlcy9hcGkvZGVhbHMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0U2Vzc2lvbiB9IGZyb20gJ25leHQtYXV0aC9yZWFjdCc7XG5pbXBvcnQgZGJDb25uZWN0IGZyb20gJy4uLy4uLy4uL2xpYi9tb25nb2RiJztcbmltcG9ydCBEZWFsIGZyb20gJy4uLy4uLy4uL21vZGVscy9EZWFsJztcbmltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcbiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlc3Npb24oeyByZXEgfSk7XG4gIFxuICAvLyBDaGVjayBpZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgaWYgKCFzZXNzaW9uKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdZb3UgbXVzdCBiZSBzaWduZWQgaW4gdG8gYWNjZXNzIHRoaXMgZW5kcG9pbnQnIH0pO1xuICB9XG4gIFxuICAvLyBFeHRyYWN0IHVzZXIgSUQgZnJvbSBzZXNzaW9uXG4gIGNvbnN0IHVzZXJJZCA9IHNlc3Npb24udXNlci5pZDtcbiAgXG4gIC8vIENvbm5lY3QgdG8gdGhlIGRhdGFiYXNlXG4gIHRyeSB7XG4gICAgYXdhaXQgZGJDb25uZWN0KCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcgfSk7XG4gIH1cbiAgXG4gIC8vIEhhbmRsZSBkaWZmZXJlbnQgSFRUUCBtZXRob2RzXG4gIHN3aXRjaCAocmVxLm1ldGhvZCkge1xuICAgIGNhc2UgJ0dFVCc6XG4gICAgICByZXR1cm4gaGFuZGxlR2V0KHJlcSwgcmVzLCB1c2VySWQpO1xuICAgIGNhc2UgJ1BPU1QnOlxuICAgICAgcmV0dXJuIGhhbmRsZVBvc3QocmVxLCByZXMsIHVzZXJJZCk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxufVxuXG4vLyBHRVQgaGFuZGxlciAtIEdldCBhbGwgZGVhbHMgZm9yIGEgdXNlclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2V0KHJlcSwgcmVzLCB1c2VySWQpIHtcbiAgdHJ5IHtcbiAgICAvLyBDb252ZXJ0IHN0cmluZyBJRCB0byBNb25nb0RCIE9iamVjdElkXG4gICAgY29uc3Qgb2JqZWN0SWQgPSBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5pc1ZhbGlkKHVzZXJJZCkgXG4gICAgICA/IG5ldyBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpXG4gICAgICA6IHVzZXJJZDsgLy8gRmFsbCBiYWNrIHRvIHN0cmluZyBJRCBpZiBub3QgdmFsaWQgT2JqZWN0SWRcbiAgICBcbiAgICAvLyBRdWVyeSBhbGwgZGVhbHMgZm9yIHRoZSB1c2VyXG4gICAgY29uc3QgZGVhbHMgPSBhd2FpdCBEZWFsLmZpbmQoeyB1c2VySWQ6IG9iamVjdElkIH0pXG4gICAgICAuc29ydCh7IGNyZWF0ZWRBdDogLTEgfSkgLy8gTGF0ZXN0IGZpcnN0XG4gICAgICAubGVhbigpOyAvLyBDb252ZXJ0IHRvIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0c1xuICAgIFxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihkZWFscyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgZGVhbHM6JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIGRlYWxzJyB9KTtcbiAgfVxufVxuXG4vLyBQT1NUIGhhbmRsZXIgLSBDcmVhdGUgYSBuZXcgZGVhbFxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlUG9zdChyZXEsIHJlcywgdXNlcklkKSB7XG4gIHRyeSB7XG4gICAgLy8gVmFsaWRhdGUgcmVxdWVzdCBib2R5XG4gICAgY29uc3QgZGVhbERhdGEgPSByZXEuYm9keTtcbiAgICBpZiAoIWRlYWxEYXRhIHx8IHR5cGVvZiBkZWFsRGF0YSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBkZWFsIGRhdGEnIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBDb252ZXJ0IHN0cmluZyBJRCB0byBNb25nb0RCIE9iamVjdElkXG4gICAgY29uc3Qgb2JqZWN0SWQgPSBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5pc1ZhbGlkKHVzZXJJZCkgXG4gICAgICA/IG5ldyBtb25nb29zZS5UeXBlcy5PYmplY3RJZCh1c2VySWQpXG4gICAgICA6IHVzZXJJZDsgLy8gRmFsbCBiYWNrIHRvIHN0cmluZyBJRCBpZiBub3QgdmFsaWQgT2JqZWN0SWRcbiAgICBcbiAgICAvLyBDcmVhdGUgYSBuZXcgZGVhbFxuICAgIGNvbnN0IGRlYWwgPSBuZXcgRGVhbCh7XG4gICAgICAuLi5kZWFsRGF0YSxcbiAgICAgIHVzZXJJZDogb2JqZWN0SWRcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTYXZlIHRoZSBkZWFsXG4gICAgY29uc3Qgc2F2ZWREZWFsID0gYXdhaXQgZGVhbC5zYXZlKCk7XG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSBzYXZlZCBkZWFsXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHNhdmVkRGVhbCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgZGVhbDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGRlYWwnIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbImdldFNlc3Npb24iLCJkYkNvbm5lY3QiLCJEZWFsIiwibW9uZ29vc2UiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwic2Vzc2lvbiIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInVzZXJJZCIsInVzZXIiLCJpZCIsImNvbnNvbGUiLCJtZXRob2QiLCJoYW5kbGVHZXQiLCJoYW5kbGVQb3N0Iiwib2JqZWN0SWQiLCJUeXBlcyIsIk9iamVjdElkIiwiaXNWYWxpZCIsImRlYWxzIiwiZmluZCIsInNvcnQiLCJjcmVhdGVkQXQiLCJsZWFuIiwiZGVhbERhdGEiLCJib2R5IiwiZGVhbCIsInNhdmVkRGVhbCIsInNhdmUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/deals/index.js\n");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next-auth/react":
/*!**********************************!*\
  !*** external "next-auth/react" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("next-auth/react");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdeals&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdeals%2Findex.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();